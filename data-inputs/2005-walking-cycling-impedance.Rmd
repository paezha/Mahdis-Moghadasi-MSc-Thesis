---
title: "Calculating Walking and cycling trips impedance function- 2005"
---

# Calculating Walking trips impedance function- 2005

First load all of the libraries

```{r load-packages, include=FALSE, cache=FALSE}
#load all packages:
library(fitdistrplus) # Help to Fit of a Parametric Distribution to Non-Censored or Censored Data
library(tidyverse) # Easily Install and Load the 'Tidyverse'
library(here)
library(dplyr) # A Grammar of Data Manipulation
library(ggplot2) # Create Elegant Data Visualisations Using the Grammar of Graphics
library(readxl) # Read Excel Files 
library(splitstackshape) # Stack and Reshape Datasets After Splitting Concatenated Values
library(tibble) # Simple Data Frames
library(readr) # Read Rectangular Text Data
library(tabulate) # Pretty Console Output for Tables
library(janitor) # Simple Tools for Examining and Cleaning Dirty Data
library(kableExtra) # Construct Complex Table with 'kable' and Pipe Syntax
library(flextable) # Functions for Tabular Reporting
```

Here, the "walking_2005" dataset, which was constructed using the General Social Survey (GSS) dataset for walking trips in 2005, has been loaded.

```{r}
# Load the dataset
load(file = paste0(here(), "/data/walking_2005.Rda"))
```

Initially, we analyzed the travel time variable (DURATION) for 2005. The minimum recorded duration for walking trips is 1 minutes, while the maximum extends to 515 minutes. Furthermore, the average and median duration for walking trips are calculated to be 12.07 minutes and 15 minutes, respectively.

```{r}
walking_2005$DURATION[walking_2005$DURATION == 0] <- 5
summary(walking_2005$DURATION)
```

Subsequently, a weighted histogram was constructed. A histogram serves as a graphical representation that illustrates the frequency distribution of a dataset corresponding to a single variable. Typically, histograms organize data into `bins` or `range groups`, tallying the quantity of data points within each bin. This method effectively visualizes the distribution and variability of the dataset, providing insights into its underlying structure and patterns.

```{r}
ggplot(walking_2005, aes(x = DURATION )) + 
  geom_histogram(binwidth = 30) + 
  geom_vline(aes(xintercept=mean(DURATION)), color="blue", linetype="dashed", linewidth=1)
```

Here, we aim to analyze individuals who engaged in walking for more than 100 minutes, focusing on their origins and destinations. Additionally, we seek to ascertain the number of trips with a DURATION exceeding 100 minutes.

```{r}
walking_2005[walking_2005$DURATION > 100, ]
count_duration <- sum(walking_2005$DURATION > 100)
count_duration
```
As observed, out of 5533 trips, 15 trips exceed 100 minutes in duration. Consequently, we have decided to exclude these trips from our analysis because they are all recreational.

```{r}
walking_2005 <- walking_2005 %>% filter(DURATION < 100)
summary(walking_2005$DURATION)
```

In our analysis to calculate the impedance function, we turned to the `Fitdistrplus` package in R, an essential tool for fitting distributions to data. In the first step, the skewness-kurtosis plot was created. This plot is crucial for pinpointing the Pearson distribution that best matches our data. The process starts with the `descdist` function, which calculates key descriptive statistics like the minimum, maximum, median, mean, standard deviation, skewness, and kurtosis.

Building on the groundwork laid by Cullen and Frey in 1999, our skewness-kurtosis plot helps us scrutinize the empirical distribution of our dataset. This plot clearly demarcates specific values or regions associated with common statistical distributions, aiding us in visually identifying the optimal model for our analysis. Distributions that exhibit fixed skewness and kurtosis values—such as normal, uniform, logistic, and exponential—appear as distinct points on the plot. This feature is particularly handy, as it indicates that data conforming to these distributions will align with those precise points, simplifying the identification process.

However, the plot also caters to distributions like gamma and log-normal, represented as lines, suggesting a variety of potential skewness and kurtosis values they can embody. This aspect is vital for understanding the flexibility these distributions offer when fitting data that may not align perfectly with a single model. Similarly, the beta distribution's broader areas on the plot signify its adaptability in form, accommodating a wider array of data shapes.

This visual tool, enriched by the comparative ease it brings to distribution selection, underscores the value of nuanced data analysis. By integrating these insights, we are better equipped to select the distribution that most accurately reflects the underlying characteristics of our data, enhancing the reliability and precision of our findings.


```{r creating Cullen and Frey graph for walkig 2005}
# creating a skew vs. kurtois graph for walking 2005

descdist(walking_2005$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```
As illustrated in the Cullen and Frey graph, the Weibull, gamma,and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}

# The Duration column contains four zero values. Before proceeding to calculate the gamma, weibull and lognormal distribution, a preprocessing step was undertaken, converting these zero values to the value of five.

# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution

gamma_w_2005_ <- fitdistrplus::fitdist(data=walking_2005$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(walking_2005$WGHT_EPI))

fit_dgamma <- data.frame(f = dgamma(walking_2005$DURATION, shape = gamma_w_2005_$estimate[1], rate = gamma_w_2005_$estimate[2]), x = walking_2005$DURATION, type = "Gamma")

summary(gamma_w_2005_)

plot(x= fit_dgamma$x, y=fit_dgamma$f)

#Calculating weibull distribution
weibull_w_2005_ <- fitdistrplus::fitdist(data=walking_2005$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(walking_2005$WGHT_EPI))

summary(weibull_w_2005_)

fit_dweibull <- data.frame(f = dweibull(walking_2005$DURATION, shape = weibull_w_2005_$estimate[1], scale = weibull_w_2005_$estimate[2]), x = walking_2005$DURATION, type = "weibull")

plot(x= fit_dweibull$x, y=fit_dweibull$f)


#Calculating exponential distribution
exp_w_2005_ <- fitdistrplus::fitdist(data=walking_2005$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(walking_2005$WGHT_EPI))

summary(exp_w_2005_)
rate_estimate <- exp_w_2005_$estimate[1]
fit_dexp <- data.frame(f = dexp(walking_2005$DURATION, rate = rate_estimate), 
                       x = walking_2005$DURATION, type = "exp")

plot(x = fit_dexp$x, y = fit_dexp$f)


```

Now let's compare these models based on AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walking data best:
broom::glance(MASS::fitdistr(walking_2005$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(walking_2005$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(walking_2005$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

In the evaluation of different statistical models, we often rely on metrics such as the log-likelihood, Akaike Information Criterion (AIC), and Bayesian Information Criterion (BIC). The log-likelihood provides an estimate of the probability of observing our data under each model, with higher values being preferable. Both the AIC and BIC extend beyond mere goodness of fit, incorporating a penalty for excessive complexity to strike a balance between model accuracy and simplicity. The objective is to identify a model that not only fits the data well but also adheres to the principle of parsimony. Typically, models with lower AIC or BIC values are deemed more desirable.

Upon analysis of the gamma, weibull and exponential distribution outputs, it is observed that the gamma distribution achieves a superior log-likelihood and more favorable (lower) AIC and BIC scores. These findings indicate that the gamma distribution provides a closer fit to our data compared to the exponential and weibull distributions, and it does so without introducing undue complexity. In essence, this distribution efficiently encapsulates the core characteristics of our data.

```{r}
walking_2005_gamma <- gamma_w_2005_
walking_2005 <- walking_2005 %>%
 mutate(f = dgamma(DURATION, walking_2005_gamma$estimate["shape"], walking_2005_gamma$estimate["rate"])) 
summary(walking_2005$f)

```


##Calculating Impedance function based on different purposes- walking 2005

###Destination :Home (1)

The skewness vs. kurtosis graph provides descriptive statistics for walking trips to home destinations:

```{r creating Cullen and Frey graph for walkig 2005 - Home (1)}
# creating a skew vs. kurtois graph for walking 2005

# Filter the data based on the "destination" column
 w_1_2005 <- walking_2005 %>%
  filter(destination == "1")   
descdist(w_1_2005$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the gamma, weibull and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_w1_2005_ <- fitdistrplus::fitdist(data=w_1_2005$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_1_2005$WGHT_EPI))

fit_dgamma_w105 <- data.frame(f = dgamma(w_1_2005$DURATION, shape = gamma_w1_2005_$estimate[1], rate = gamma_w1_2005_$estimate[2]), x = w_1_2005$DURATION, type = "Gamma")

summary(gamma_w1_2005_)

plot(x= fit_dgamma_w105$x, y=fit_dgamma_w105$f)

#Calculating weibull distribution
weibull_w1_2005_ <- fitdistrplus::fitdist(data=w_1_2005$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(w_1_2005$WGHT_EPI))

summary(weibull_w1_2005_)

fit_dweibull_w105 <- data.frame(f = dweibull(w_1_2005$DURATION, shape = weibull_w1_2005_$estimate[1], scale = weibull_w1_2005_$estimate[2]), x = w_1_2005$DURATION, type = "weibull")

plot(x= fit_dweibull_w105$x, y=fit_dweibull_w105$f)

#Calculating exponential distribution
exp_w1_2005_ <- fitdistrplus::fitdist(data=w_1_2005$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_1_2005$WGHT_EPI))

summary(exp_w1_2005_)

fit_dexp_w105 <- data.frame(f = dexp(w_1_2005$DURATION, rate = exp_w1_2005_$estimate[1]), 
                       x = w_1_2005$DURATION, type = "exp")

plot(x = fit_dexp_w105$x, y = fit_dexp_w105$f)

```

Now let's compare these models AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walking data best:
broom::glance(MASS::fitdistr(w_1_2005$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_1_2005$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(w_1_2005$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for walking trips in 2005!

```{r}
walking_105_gamma <- gamma_w1_2005_
w_1_2005 <- w_1_2005 %>%
 mutate(f_1 = dgamma(DURATION, walking_105_gamma$estimate["shape"], walking_105_gamma$estimate["rate"])) 
summary(w_1_2005$f_1)
```


###Destination : Work or school (2 and 8)

The skewness vs. kurtosis graph provides descriptive statistics for walking trips to Work or school destinations:

```{r creating Cullen and Frey graph for walkig 2005 - Work or school (2 and 8)}
# creating a skew vs. kurtois graph for walking 2005- Work or school (2 and 8)

# Filter the data based on the "destination" column
 w_2_2005 <- walking_2005 %>%
  filter(destination %in% c("2", "8"))   
descdist(w_2_2005$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```
As illustrated in the Cullen and Frey graph, the gamma and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_w2_2005_ <- fitdistrplus::fitdist(data=w_2_2005$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_2_2005$WGHT_EPI))

fit_dgamma_w205 <- data.frame(f = dgamma(w_2_2005$DURATION, shape = gamma_w2_2005_$estimate[1], rate = gamma_w2_2005_$estimate[2]), x = w_2_2005$DURATION, type = "Gamma")

summary(gamma_w2_2005_)

plot(x= fit_dgamma_w205$x, y=fit_dgamma_w205$f)

#Calculating exponential distribution
exp_w2_2005_ <- fitdistrplus::fitdist(data=w_2_2005$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_2_2005$WGHT_EPI))

summary(exp_w2_2005_)

fit_dexp_w205 <- data.frame(f = dexp(w_2_2005$DURATION, rate = exp_w2_2005_$estimate[1]), 
                       x = w_2_2005$DURATION, type = "exp")

plot(x = fit_dexp_w205$x, y = fit_dexp_w205$f)

```

Now let's compare these models AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walking data best:
broom::glance(MASS::fitdistr(w_2_2005$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_2_2005$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for walking trips in 2005!

```{r}
walking_205_gamma <- gamma_w2_2005_
w_2_2005 <- w_2_2005 %>%
 mutate(f_2 = dgamma(DURATION, walking_205_gamma$estimate["shape"], walking_205_gamma$estimate["rate"])) 
summary(w_2_2005$f_2)
```


###Destination : other's home (3)

The skewness vs. kurtosis graph provides descriptive statistics for walking trips to other's home destinations:

```{r creating Cullen and Frey graph for walkig 2005 - other home (3)}
# creating a skew vs. kurtois graph for walking 2005 - other home (3)

# Filter the data based on the "destination" column
 w_3_2005 <- walking_2005 %>%
  filter(destination == "3")   
descdist(w_3_2005$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the gamma, weibull, lognormal and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_w3_2005_ <- fitdistrplus::fitdist(data=w_3_2005$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_3_2005$WGHT_EPI))

fit_dgamma_w305 <- data.frame(f = dgamma(w_3_2005$DURATION, shape = gamma_w3_2005_$estimate[1], rate = gamma_w3_2005_$estimate[2]), x = w_3_2005$DURATION, type = "Gamma")

summary(gamma_w3_2005_)

#Calculating weibull distribution 
weibull_w3_2005_ <- fitdistrplus::fitdist(data=w_3_2005$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(w_3_2005$WGHT_EPI))

fit_dweibull_w305 <- data.frame(f = dweibull(w_3_2005$DURATION, shape = weibull_w3_2005_$estimate[1], scale = weibull_w3_2005_$estimate[2]), x = w_3_2005$DURATION, type = "weibull")

summary(weibull_w3_2005_)

plot(x= fit_dweibull_w305$x, y=fit_dweibull_w305$f)

#Calculating lognormal distribution 
lnorm_w3_2005_ <- fitdistrplus::fitdist(data=w_3_2005$DURATION%>% unlist() %>% as.numeric(), "lnorm", method="mle", optim.method="Nelder-Mead", weights = round(w_3_2005$WGHT_EPI))

fit_dlnorm_w305 <- data.frame(f = dlnorm(w_3_2005$DURATION, meanlog = lnorm_w3_2005_$estimate[1], sdlog = lnorm_w3_2005_$estimate[2]), x = w_3_2005$DURATION, type = "lnorm")

summary(lnorm_w3_2005_)

plot(x= fit_dlnorm_w305$x, y=fit_dlnorm_w305$f)

#Calculating exponential distribution
exp_w3_2005_ <- fitdistrplus::fitdist(data=w_3_2005$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_3_2005$WGHT_EPI))

summary(exp_w3_2005_)

fit_dexp_w305 <- data.frame(f = dexp(w_3_2005$DURATION, rate = exp_w3_2005_$estimate[1]), 
                       x = w_3_2005$DURATION, type = "exp")

plot(x = fit_dexp_w305$x, y = fit_dexp_w305$f)

```

Now let's compare these models AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walking data best:
broom::glance(MASS::fitdistr(w_3_2005$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_3_2005$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(w_3_2005$DURATION%>% unlist() %>% as.numeric(),"lognormal"))
broom::glance(MASS::fitdistr(w_3_2005$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, lognormal has largest logLik and the smallest AIC and BIC. we will pick lognormal function for walking trips in 2005!

```{r}
walking_305_lnorm <- lnorm_w3_2005_
w_3_2005 <- w_3_2005 %>%
 mutate(f_3 = dlnorm(DURATION, walking_305_lnorm$estimate["meanlog"], walking_305_lnorm$estimate["sdlog"])) 
summary(w_3_2005$f_3)
```

###Destination : Restaurant/bar (4)

The skewness vs. kurtosis graph provides descriptive statistics for walking trips to Restaurant or bar destinations:

```{r creating Cullen and Frey graph for walkig 2005 - Restaurant or bar (4)}
# creating a skew vs. kurtois graph for walking 2005- Restaurant or bar 

# Filter the data based on the "destination" column
 w_4_2005 <- walking_2005 %>%
  filter(destination == "4")   
descdist(w_4_2005$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the gamma, weibull, lognormal and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_w4_2005_ <- fitdistrplus::fitdist(data=w_4_2005$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_4_2005$WGHT_EPI))

fit_dgamma_w405 <- data.frame(f = dgamma(w_4_2005$DURATION, shape = gamma_w4_2005_$estimate[1], rate = gamma_w4_2005_$estimate[2]), x = w_4_2005$DURATION, type = "Gamma")

summary(gamma_w4_2005_)

plot(x= fit_dgamma_w405$x, y=fit_dgamma_w405$f)

#Calculating weibull distribution
weibull_w4_2005_ <- fitdistrplus::fitdist(data=w_4_2005$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(w_4_2005$WGHT_EPI))

summary(weibull_w4_2005_)

fit_dweibull_w405 <- data.frame(f = dweibull(w_4_2005$DURATION, shape = weibull_w4_2005_$estimate[1], scale = weibull_w4_2005_$estimate[2]), x = w_4_2005$DURATION, type = "weibull")

plot(x= fit_dweibull_w405$x, y=fit_dweibull_w405$f)

#Calculating exponential distribution
exp_w4_2005_ <- fitdistrplus::fitdist(data=w_4_2005$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_4_2005$WGHT_EPI))

summary(exp_w4_2005_)

fit_dexp_w405 <- data.frame(f = dexp(w_4_2005$DURATION, rate = exp_w4_2005_$estimate[1]), 
                       x = w_4_2005$DURATION, type = "exp")

plot(x = fit_dexp_w405$x, y = fit_dexp_w405$f)

#Calculating lognormal distribution
lnorm_w4_2005_ <- fitdistrplus::fitdist(data=w_4_2005$DURATION%>% unlist() %>% as.numeric(), "lnorm", method="mle", optim.method="Nelder-Mead", weights = round(w_4_2005$WGHT_EPI))

summary(lnorm_w4_2005_)

fit_dlnorm_w405 <- data.frame(f = dlnorm(w_4_2005$DURATION, meanlog = lnorm_w4_2005_$estimate[1], sdlog = lnorm_w4_2005_$estimate[2]),  x = w_4_2005$DURATION, type = "lnorm")

plot(x = fit_dlnorm_w405$x, y = fit_dlnorm_w405$f)

```

Now let's compare these models AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walking data best:
broom::glance(MASS::fitdistr(w_4_2005$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_4_2005$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(w_4_2005$DURATION%>% unlist() %>% as.numeric(),"exponential"))
broom::glance(MASS::fitdistr(w_4_2005$DURATION%>% unlist() %>% as.numeric(),"lognormal"))
```

So, lognormal has largest logLik and the smallest AIC and BIC. we will pick lognormal function for walking trips in 2005!

```{r}
walking_405_lnorm <- lnorm_w4_2005_
w_4_2005 <- w_4_2005 %>%
 mutate(f_4 = dlnorm(DURATION, walking_405_lnorm$estimate["meanlog"], walking_405_lnorm$estimate["sdlog"])) 
summary(w_4_2005$f_4)
```

###Destination : Place of worship (5)

The skewness vs. kurtosis graph provides descriptive statistics for walking trips to Place of worship destination:

```{r creating Cullen and Frey graph for walkig 2005 - Place of worship (5)}
# creating a skew vs. kurtois graph for walking 2005 -Place of worship

# Filter the data based on the "destination" column
 w_5_2005 <- walking_2005 %>%
  filter(destination == "5")   
descdist(w_5_2005$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the gamma and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_w5_2005_ <- fitdistrplus::fitdist(data=w_5_2005$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_5_2005$WGHT_EPI))

fit_dgamma_w505 <- data.frame(f = dgamma(w_5_2005$DURATION, shape = gamma_w5_2005_$estimate[1], rate = gamma_w5_2005_$estimate[2]), x = w_5_2005$DURATION, type = "Gamma")

summary(gamma_w5_2005_)

plot(x= fit_dgamma_w505$x, y=fit_dgamma_w505$f)


#Calculating exponential distribution
exp_w5_2005_ <- fitdistrplus::fitdist(data=w_5_2005$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_5_2005$WGHT_EPI))

summary(exp_w5_2005_)

fit_dexp_w505 <- data.frame(f = dexp(w_5_2005$DURATION, rate = exp_w5_2005_$estimate[1]), 
                       x = w_5_2005$DURATION, type = "exp")

plot(x = fit_dexp_w505$x, y = fit_dexp_w505$f)

```

Now let's compare these models AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walking data best:
broom::glance(MASS::fitdistr(w_5_2005$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_5_2005$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for walking trips in 2005!

```{r}
walking_505_gamma <- gamma_w5_2005_
w_5_2005 <- w_5_2005 %>%
 mutate(f_5 = dgamma(DURATION, walking_505_gamma$estimate["shape"], walking_505_gamma$estimate["rate"])) 
summary(w_5_2005$f_5)
```


###Destination :Grocery store, other stores or mall (6 and 7)

The skewness vs. kurtosis graph provides descriptive statistics for walking trips to grocery store, other stores or mall  destinations:

```{r creating Cullen and Frey graph for walkig 2005 - Grocery store, other stores or mall (6 and 7)}
# creating a skew vs. kurtois graph for walking 2005 -Grocery store, other stores or mall 

# Filter the data based on the "destination" column
 w_6_2005 <- walking_2005 %>%
  filter(destination %in% c("6", "7"))   
descdist(w_6_2005$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the gamma, weibull and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_w6_2005_ <- fitdistrplus::fitdist(data=w_6_2005$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_6_2005$WGHT_EPI))

fit_dgamma_w605 <- data.frame(f = dgamma(w_6_2005$DURATION, shape = gamma_w6_2005_$estimate[1], rate = gamma_w6_2005_$estimate[2]), x = w_6_2005$DURATION, type = "Gamma")

summary(gamma_w6_2005_)

plot(x= fit_dgamma_w605$x, y=fit_dgamma_w605$f)

#Calculating weibull distribution
weibull_w6_2005_ <- fitdistrplus::fitdist(data=w_6_2005$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(w_6_2005$WGHT_EPI))

summary(weibull_w6_2005_)

fit_dweibull_w605 <- data.frame(f = dweibull(w_6_2005$DURATION, shape = weibull_w6_2005_$estimate[1], scale = weibull_w6_2005_$estimate[2]), x = w_6_2005$DURATION, type = "weibull")

plot(x= fit_dweibull_w605$x, y=fit_dweibull_w605$f)

#Calculating exponential distribution
exp_w6_2005_ <- fitdistrplus::fitdist(data=w_6_2005$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_6_2005$WGHT_EPI))

summary(exp_w6_2005_)

fit_dexp_w605 <- data.frame(f = dexp(w_6_2005$DURATION, rate = exp_w6_2005_$estimate[1]), 
                       x = w_6_2005$DURATION, type = "exp")

plot(x = fit_dexp_w605$x, y = fit_dexp_w605$f)

```

Now let's compare these models AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walk data best:
broom::glance(MASS::fitdistr(w_6_2005$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_6_2005$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(w_6_2005$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for walking trips in 2005!

```{r}
walking_605_gamma <- gamma_w6_2005_
w_6_2005 <- w_6_2005 %>%
 mutate(f_6 = dgamma(DURATION, walking_605_gamma$estimate["shape"], walking_605_gamma$estimate["rate"])) 
summary(w_6_2005$f_6)
```

###Destination : Outdoors (9)

The skewness vs. kurtosis graph provides descriptive statistics for walking trips to Outdoors destination:

```{r creating Cullen and Frey graph for walkig 2005 - Outdoors (9)}
# creating a skew vs. kurtois graph for walking 2005 - Outdoors

# Filter the data based on the "destination" column
 w_9_2005 <- walking_2005 %>%
  filter(destination == "9")   
descdist(w_9_2005$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the gamma, weibull and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_w9_2005_ <- fitdistrplus::fitdist(data=w_9_2005$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_9_2005$WGHT_EPI))

fit_dgamma_w905 <- data.frame(f = dgamma(w_9_2005$DURATION, shape = gamma_w9_2005_$estimate[1], rate = gamma_w9_2005_$estimate[2]), x = w_9_2005$DURATION, type = "Gamma")

summary(gamma_w9_2005_)

plot(x= fit_dgamma_w905$x, y=fit_dgamma_w905$f)

#Calculating exponential distribution
exp_w9_2005_ <- fitdistrplus::fitdist(data=w_9_2005$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_9_2005$WGHT_EPI))

summary(exp_w9_2005_)

fit_dexp_w905 <- data.frame(f = dexp(w_9_2005$DURATION, rate = exp_w9_2005_$estimate[1]), 
                       x = w_9_2005$DURATION, type = "exp")

plot(x = fit_dexp_w905$x, y = fit_dexp_w905$f)

#Calculating weibull distribution
weibull_w9_2005_ <- fitdistrplus::fitdist(data=w_9_2005$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(w_9_2005$WGHT_EPI))

summary(weibull_w9_2005_)

fit_dweibull_w905 <- data.frame(f = dweibull(w_9_2005$DURATION, shape = weibull_w9_2005_$estimate[1], scale = weibull_w9_2005_$estimate[2]),  x = w_9_2005$DURATION, type = "weibull")

plot(x = fit_dweibull_w905$x, y = fit_dweibull_w905$f)

```

Now let's compare these models AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walking data best:
broom::glance(MASS::fitdistr(w_9_2005$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_9_2005$DURATION%>% unlist() %>% as.numeric(),"exponential"))
broom::glance(MASS::fitdistr(w_9_2005$DURATION%>% unlist() %>% as.numeric(),"weibull"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for walking trips in 2005!

```{r}
walking_905_gamma <- gamma_w9_2005_
w_9_2005 <- w_9_2005 %>%
 mutate(f_9 = dgamma(DURATION, walking_905_gamma$estimate["shape"], walking_905_gamma$estimate["rate"])) 
summary(w_9_2005$f_9)
```


###Destination : Library, museum or theatre (10)

The skewness vs. kurtosis graph provides descriptive statistics for walking trips to library, museum or theatre destinations:

```{r creating Cullen and Frey graph for walkig 2005 - Library, museum or theatre (10)}
# creating a skew vs. kurtois graph for walking 2005

# Filter the data based on the "destination" column
 w_10_2005 <- walking_2005 %>%
  filter(destination == "10")   
descdist(w_10_2005$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the gamma, normal, weibull, lognormal and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_w10_2005_ <- fitdistrplus::fitdist(data=w_10_2005$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_10_2005$WGHT_EPI))

fit_dgamma_w1005 <- data.frame(f = dgamma(w_10_2005$DURATION, shape = gamma_w10_2005_$estimate[1], rate = gamma_w10_2005_$estimate[2]), x = w_10_2005$DURATION, type = "Gamma")

summary(gamma_w10_2005_)

plot(x= fit_dgamma_w1005$x, y=fit_dgamma_w1005$f)

#Calculating exponential distribution
exp_w10_2005_ <- fitdistrplus::fitdist(data=w_10_2005$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_10_2005$WGHT_EPI))

summary(exp_w10_2005_)

fit_dexp_w1005 <- data.frame(f = dexp(w_10_2005$DURATION, rate = exp_w10_2005_$estimate[1]), 
                       x = w_10_2005$DURATION, type = "exp")

plot(x = fit_dexp_w1005$x, y = fit_dexp_w1005$f)

#Calculating normal distribution
norm_w10_2005_ <- fitdistrplus::fitdist(data=w_10_2005$DURATION%>% unlist() %>% as.numeric(), "norm", method="mle", optim.method="Nelder-Mead", weights = round(w_10_2005$WGHT_EPI))

summary(norm_w10_2005_)

fit_dnorm_w1005 <- data.frame(f = dnorm(w_10_2005$DURATION, mean = norm_w10_2005_$estimate[1], sd = norm_w10_2005_$estimate[2]),  x = w_10_2005$DURATION, type = "norm")

plot(x = fit_dnorm_w1005$x, y = fit_dnorm_w1005$f)

#Calculating lognormal distribution
lnorm_w10_2005_ <- fitdistrplus::fitdist(data=w_10_2005$DURATION%>% unlist() %>% as.numeric(), "lnorm", method="mle", optim.method="Nelder-Mead", weights = round(w_10_2005$WGHT_EPI))

summary(lnorm_w10_2005_)

fit_dlnorm_w1005 <- data.frame(f = dlnorm(w_10_2005$DURATION, meanlog = lnorm_w10_2005_$estimate[1], sdlog = lnorm_w10_2005_$estimate[2]),  x = w_10_2005$DURATION, type = "lnorm")

plot(x = fit_dlnorm_w1005$x, y = fit_dlnorm_w1005$f)

#Calculating weibull distribution
weibull_w10_2005_ <- fitdistrplus::fitdist(data=w_10_2005$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(w_10_2005$WGHT_EPI))

summary(weibull_w10_2005_)

fit_dweibull_w1005 <- data.frame(f = dweibull(w_10_2005$DURATION, shape = weibull_w10_2005_$estimate[1], scale = weibull_w10_2005_$estimate[2]),  x = w_10_2005$DURATION, type = "weibull")

plot(x = fit_dweibull_w1005$x, y = fit_dweibull_w1005$f)
```

Now let's compare these models AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walking data best:
broom::glance(MASS::fitdistr(w_10_2005$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_10_2005$DURATION%>% unlist() %>% as.numeric(),"exponential"))
broom::glance(MASS::fitdistr(w_10_2005$DURATION%>% unlist() %>% as.numeric(),"normal"))
broom::glance(MASS::fitdistr(w_10_2005$DURATION%>% unlist() %>% as.numeric(),"lognormal"))
broom::glance(MASS::fitdistr(w_10_2005$DURATION%>% unlist() %>% as.numeric(),"weibull"))
```

So, lognormal has largest logLik and the smallest AIC and BIC. we will pick lognormal function for walking trips in 2005!

```{r}
walking_1005_lnorm <- lnorm_w10_2005_
w_10_2005 <- w_10_2005 %>%
 mutate(f_10 = dlnorm(DURATION, walking_1005_lnorm$estimate["meanlog"], walking_1005_lnorm$estimate["sdlog"])) 
summary(w_10_2005$f_10)
```

# Calculating cycling trips impedance function- 2005


Here, the "cycling_2005" dataset, which was constructed using the General Social Survey (GSS) dataset for cycling trips in 2005, has been loaded.

```{r}
# Load the dataset
load(file = paste0(here(), "/data/cycling_2005.Rda"))
```

Initially, we analyzed the travel time variable (DURATION) for 2005. The minimum recorded duration for cycling trips is 1 minutes, while the maximum extends to 180 minutes. Furthermore, the average and median duration for cycling trips are calculated to be 25 minutes and 15 minutes, respectively.

```{r}
summary(cycling_2005$DURATION)
```

Subsequently, a weighted histogram was constructed. A histogram serves as a graphical representation that illustrates the frequency distribution of a dataset corresponding to a single variable. Typically, histograms organize data into `bins` or `range groups`, tallying the quantity of data points within each bin. This method effectively visualizes the distribution and variability of the dataset, providing insights into its underlying structure and patterns.

```{r}
ggplot(cycling_2005, aes(x = DURATION )) + 
  geom_histogram(binwidth = 30) + 
  geom_vline(aes(xintercept=mean(DURATION)), color="blue", linetype="dashed", linewidth=1)
```

Here, we aim to analyze individuals who engaged in cycling for more than 120 minutes, focusing on their origins and destinations. Additionally, we seek to ascertain the number of trips with a DURATION exceeding 120 minutes.

```{r}

count <- sum(cycling_2005$DURATION > 120)
print (count)
```
As observed, out of 333 trips, 1 exceed 120 minutes in duration. Consequently, we have decided to exclude these trips from our analysis because they are all recreational.

```{r}
cycling_2005 <- cycling_2005 %>% filter(DURATION < 120)
summary(cycling_2005$DURATION)
```

In our analysis to calculate the impedance function, we turned to the `Fitdistrplus` package in R, an essential tool for fitting distributions to data. In the first step, the skewness-kurtosis plot was created. This plot is crucial for pinpointing the Pearson distribution that best matches our data. The process starts with the `descdist` function, which calculates key descriptive statistics like the minimum, maximum, median, mean, standard deviation, skewness, and kurtosis.

Building on the groundwork laid by Cullen and Frey in 1999, our skewness-kurtosis plot helps us scrutinize the empirical distribution of our dataset. This plot clearly demarcates specific values or regions associated with common statistical distributions, aiding us in visually identifying the optimal model for our analysis. Distributions that exhibit fixed skewness and kurtosis values—such as normal, uniform, logistic, and exponential—appear as distinct points on the plot. This feature is particularly handy, as it indicates that data conforming to these distributions will align with those precise points, simplifying the identification process.

However, the plot also caters to distributions like gamma and lognormal, represented as lines, suggesting a variety of potential skewness and kurtosis values they can embody. This aspect is vital for understanding the flexibility these distributions offer when fitting data that may not align perfectly with a single model. Similarly, the beta distribution's broader areas on the plot signify its adaptability in form, accommodating a wider array of data shapes.

This visual tool, enriched by the comparative ease it brings to distribution selection, underscores the value of nuanced data analysis. By integrating these insights, we are better equipped to select the distribution that most accurately reflects the underlying characteristics of our data, enhancing the reliability and precision of our findings.


```{r creating Cullen and Frey graph for cycling 2005}
# creating a skew vs. kurtois graph for cycling 2005

descdist(cycling_2005$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```
As illustrated in the Cullen and Frey graph, the gamma, weibull, and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.


```{r}

# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution

gamma_c_2005_ <- fitdistrplus::fitdist(data=cycling_2005$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(cycling_2005$WGHT_EPI))


fit_dgamma <- data.frame(f = dgamma(cycling_2005$DURATION, shape = gamma_c_2005_$estimate[1], rate = gamma_c_2005_$estimate[2]), x = cycling_2005$DURATION, type = "gamma")

summary(gamma_c_2005_)

plot(x= fit_dgamma$x, y=fit_dgamma$f)


#Calculating exponential distribution
exp_c_2005_ <- fitdistrplus::fitdist(data=cycling_2005$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(cycling_2005$WGHT_EPI))

summary(exp_c_2005_)

fit_dexp <- data.frame(f = dexp(cycling_2005$DURATION, rate = exp_c_2005_$estimate[1]), x = cycling_2005$DURATION, type = "exp")

plot(x= fit_dexp$x, y=fit_dexp$f)



#Calculating weibull distribution
weibull_c_2005_ <- fitdistrplus::fitdist(data=cycling_2005$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(cycling_2005$WGHT_EPI))

summary(weibull_c_2005_)

fit_dweibull <- data.frame(f = dweibull(cycling_2005$DURATION, shape = weibull_c_2005_$estimate[1], scale = weibull_c_2005_$estimate[2]), x = cycling_2005$DURATION, type = "weibull")

plot(x= fit_dweibull$x, y=fit_dweibull$f)

```

Now let's compare these models based on AIC and BIC to see which fits the cycling data best:

```{r}
#comparing these models AIC and BIC to see which fits the cycling data best:
broom::glance(MASS::fitdistr(cycling_2005$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(cycling_2005$DURATION%>% unlist() %>% as.numeric(),"exponential"))
broom::glance(MASS::fitdistr(cycling_2005$DURATION%>% unlist() %>% as.numeric(),"weibull"))
```
In the evaluation of different statistical models, we often rely on metrics such as the log-likelihood, Akaike Information Criterion (AIC), and Bayesian Information Criterion (BIC). The log-likelihood provides an estimate of the probability of observing our data under each model, with higher values being preferable. Both the AIC and BIC extend beyond mere goodness of fit, incorporating a penalty for excessive complexity to strike a balance between model accuracy and simplicity. The objective is to identify a model that not only fits the data well but also adheres to the principle of parsimony. Typically, models with lower AIC or BIC values are deemed more desirable.

Upon analysis of the gamma, weibull and exponential distribution outputs, it is observed that the gamma distribution achieves a superior log-likelihood and more favorable (lower) AIC and BIC scores. These findings indicate that the gamma distribution provides a closer fit to our data compared to the weibull and exponential distributions, and it does so without introducing undue complexity. In essence, this distribution efficiently encapsulates the core characteristics of our data.

```{r}
cycling_2005_gamma <- gamma_c_2005_
cycling_2005 <- cycling_2005 %>%
 mutate(f = dgamma(DURATION, cycling_2005_gamma$estimate[1] , cycling_2005_gamma$estimate[2])) 
summary(cycling_2005$f)

```


###Destination : Cyling - Home (1), 2005

The skewness vs. kurtosis graph provides descriptive statistics for cycling trips to home destinations:

```{r creating Cullen and Frey graph for cycling 2005- Home (1)}
# creating a skew vs. kurtois graph for cycling 2005- - Home 

# Filter the data based on the "destination" column
 c_1_2005 <- cycling_2005 %>%
  filter(destination == "1")   
descdist(c_1_2005$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the gamma, weibull and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_c1_2005_ <- fitdistrplus::fitdist(data=c_1_2005$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(c_1_2005$WGHT_EPI))

fit_dgamma_c105 <- data.frame(f = dgamma(c_1_2005$DURATION, shape = gamma_c1_2005_$estimate[1], rate = gamma_c1_2005_$estimate[2]), x = c_1_2005$DURATION, type = "Gamma")

summary(gamma_c1_2005_)

plot(x= fit_dgamma_c105$x, y=fit_dgamma_c105$f)

#Calculating weibull distribution
weibull_c1_2005_ <- fitdistrplus::fitdist(data=c_1_2005$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(c_1_2005$WGHT_EPI))

summary(weibull_c1_2005_)

fit_dweibull_c105 <- data.frame(f = dweibull(c_1_2005$DURATION, shape = weibull_c1_2005_$estimate[1], scale = weibull_c1_2005_$estimate[2]), x = c_1_2005$DURATION, type = "weibull")

plot(x= fit_dweibull_c105$x, y=fit_dweibull_c105$f)

#Calculating exponential distribution
exp_c1_2005_ <- fitdistrplus::fitdist(data=c_1_2005$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(c_1_2005$WGHT_EPI))

summary(exp_c1_2005_)

fit_dexp_c105 <- data.frame(f = dexp(c_1_2005$DURATION, rate = exp_c1_2005_$estimate[1]), 
                       x = c_1_2005$DURATION, type = "exp")

plot(x = fit_dexp_c105$x, y = fit_dexp_c105$f)

```

Now let's compare these models AIC and BIC to see which fits the cycling data best:

```{r}
#comparing these models AIC and BIC to see which fits the cycling data best:
broom::glance(MASS::fitdistr(c_1_2005$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(c_1_2005$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(c_1_2005$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for cycling trips in 2005!

```{r}
cycling_105_gamma <- gamma_c1_2005_
c_1_2005 <- c_1_2005 %>%
 mutate(f_1 = dgamma(DURATION, cycling_105_gamma$estimate["shape"], cycling_105_gamma$estimate["rate"])) 
summary(c_1_2005$f_1)
```


###Destination : Cycling - Work or school (2 and 8), 2005

The skewness vs. kurtosis graph provides descriptive statistics for cycling trips to Work or school destinations:

```{r creating Cullen and Frey graph for cycling 2005 - Work or school (2 and 8)}
# creating a skew vs. kurtois graph for cycling 2005- Work or school

# Filter the data based on the "destination" column
 c_2_2005 <- cycling_2005 %>%
  filter(destination %in% c("2", "8"))   
descdist(c_2_2005$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the gamma and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_c2_2005_ <- fitdistrplus::fitdist(data=c_2_2005$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(c_2_2005$WGHT_EPI))

fit_dgamma_c205 <- data.frame(f = dgamma(c_2_2005$DURATION, shape = gamma_c2_2005_$estimate[1], rate = gamma_c2_2005_$estimate[2]), x = c_2_2005$DURATION, type = "Gamma")

summary(gamma_c2_2005_)

plot(x= fit_dgamma_c205$x, y=fit_dgamma_c205$f)


#Calculating exponential distribution
exp_c2_2005_ <- fitdistrplus::fitdist(data=c_2_2005$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(c_2_2005$WGHT_EPI))

summary(exp_c2_2005_)

fit_dexp_c205 <- data.frame(f = dexp(c_2_2005$DURATION, rate = exp_c2_2005_$estimate[1]), 
                       x = c_2_2005$DURATION, type = "exp")

plot(x = fit_dexp_c205$x, y = fit_dexp_c205$f)


```

Now let's compare these models AIC and BIC to see which fits the cycling data best:

```{r}
#comparing these models AIC and BIC to see which fits the cycling data best:
broom::glance(MASS::fitdistr(c_2_2005$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(c_2_2005$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for cycling trips in 2005!

```{r}
cycling_205_gamma <- gamma_c2_2005_
c_2_2005 <- c_2_2005 %>%
 mutate(f_2 = dgamma(DURATION, cycling_205_gamma$estimate["shape"], cycling_205_gamma$estimate["rate"])) 
summary(c_2_2005$f_2)
```


###Destination : cycling - other's home (3), 2005

The skewness vs. kurtosis graph provides descriptive statistics for cycling trips to other's home destinations:

```{r creating Cullen and Frey graph for cycling 2005 - other home (3)}
# creating a skew vs. kurtois graph for cycling 2005- other home

# Filter the data based on the "destination" column
 c_3_2005 <- cycling_2005 %>%
  filter(destination == "3")   
descdist(c_3_2005$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the poisson, gamma and normal distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating normal distribution 
norm_c3_2005_ <- fitdistrplus::fitdist(data=c_3_2005$DURATION%>% unlist() %>% as.numeric(), "norm", method="mle", optim.method="Nelder-Mead", weights = round(c_3_2005$WGHT_EPI))

fit_dnorm_c305 <- data.frame(f = dnorm(c_3_2005$DURATION, mean = norm_c3_2005_$estimate[1], sd = norm_c3_2005_$estimate[2]), x = c_3_2005$DURATION, type = "norm")

summary(norm_c3_2005_)

plot(x= fit_dnorm_c305$x, y=fit_dnorm_c305$f)

#Calculating gamma distribution 
gamma_c3_2005_ <- fitdistrplus::fitdist(data=c_3_2005$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(c_3_2005$WGHT_EPI))

fit_dgamma_c305 <- data.frame(f = dgamma(c_3_2005$DURATION, shape = gamma_c3_2005_$estimate[1], rate = gamma_c3_2005_$estimate[2]), x = c_3_2005$DURATION, type = "gamma")

summary(gamma_c3_2005_)

plot(x= fit_dgamma_c305$x, y=fit_dgamma_c305$f)

#Calculating poisson distribution
pois_c3_2005_ <- fitdistrplus::fitdist(data=c_3_2005$DURATION%>% unlist() %>% as.numeric(), "pois", method="mle", optim.method="Nelder-Mead", weights = round(c_3_2005$WGHT_EPI))

summary(pois_c3_2005_)

fit_dpois_c305 <- data.frame(f = dpois(c_3_2005$DURATION, lambda = pois_c3_2005_$estimate[1]), 
                       x = c_3_2005$DURATION, type = "pois")

plot(x = fit_dpois_c305$x, y = fit_dpois_c305$f)

```


Now let's compare these models AIC and BIC to see which fits the cycling data best:

```{r}
#comparing these models AIC and BIC to see which fits the cycling data best:
broom::glance(MASS::fitdistr(c_3_2005$DURATION%>% unlist() %>% as.numeric(),"poisson"))
broom::glance(MASS::fitdistr(c_3_2005$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(c_3_2005$DURATION%>% unlist() %>% as.numeric(),"normal"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for cycling trips in 2005!

```{r}
cycling_305_gamma <- gamma_c3_2005_
c_3_2005 <- c_3_2005 %>%
 mutate(f_3 = dgamma(DURATION, cycling_305_gamma$estimate["shape"], cycling_305_gamma$estimate["rate"])) 
summary(c_3_2005$f_3)
```

###Destination : cycling - Restaurant/bar (4), 2005

The skewness vs. kurtosis graph provides descriptive statistics for cycling trips to Restaurant or bar destinations:

```{r creating Cullen and Frey graph for cycling 2005- Restaurant or bar (4)}
# creating a skew vs. kurtois graph for cycling 2005

# Filter the data based on the "destination" column
 c_4_2005 <- cycling_2005 %>%
  filter(destination == "4")   
descdist(c_4_2005$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the normal, poisson, gamma and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating normal distribution 
norm_c4_2005_ <- fitdistrplus::fitdist(data=c_4_2005$DURATION%>% unlist() %>% as.numeric(), "norm", method="mle", optim.method="Nelder-Mead", weights = round(c_4_2005$WGHT_EPI))

fit_dnorm_c405 <- data.frame(f = dnorm(c_4_2005$DURATION, mean = norm_c4_2005_$estimate[1], sd = norm_c4_2005_$estimate[2]), x = c_4_2005$DURATION, type = "norm")

summary(norm_c4_2005_)

plot(x= fit_dnorm_c405$x, y=fit_dnorm_c405$f)

#Calculating poisson distribution
pois_c4_2005_ <- fitdistrplus::fitdist(data=c_4_2005$DURATION%>% unlist() %>% as.numeric(), "pois", method="mle", optim.method="Nelder-Mead", weights = round(c_4_2005$WGHT_EPI))

summary(pois_c4_2005_)

fit_dpois_c405 <- data.frame(f = dpois(c_4_2005$DURATION, lambda = pois_c4_2005_$estimate[1]), x = c_4_2005$DURATION, type = "pois")

plot(x= fit_dpois_c405$x, y=fit_dpois_c405$f)


#Calculating gamma distribution
gamma_c4_2005_ <- fitdistrplus::fitdist(data=c_4_2005$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(c_4_2005$WGHT_EPI))

summary(gamma_c4_2005_)

fit_dgamma_c405 <- data.frame(f = dgamma(c_4_2005$DURATION, shape = gamma_c4_2005_$estimate[1], rate = gamma_c4_2005_$estimate[2]), x = c_4_2005$DURATION, type = "gamma")

plot(x= fit_dgamma_c405$x, y=fit_dgamma_c405$f)

#Calculating exponential distribution
exp_c4_2005_ <- fitdistrplus::fitdist(data=c_4_2005$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(c_4_2005$WGHT_EPI))

summary(exp_c4_2005_)

fit_dexp_c405 <- data.frame(f = dexp(c_4_2005$DURATION, rate = exp_c4_2005_$estimate[1]), 
                       x = c_4_2005$DURATION, type = "exp")

plot(x = fit_dexp_c405$x, y = fit_dexp_c405$f)

```

Now let's compare these models AIC and BIC to see which fits the cycling data best:

```{r}
#comparing these models AIC and BIC to see which fits the cycling data best:
broom::glance(MASS::fitdistr(c_4_2005$DURATION%>% unlist() %>% as.numeric(),"normal"))
broom::glance(MASS::fitdistr(c_4_2005$DURATION%>% unlist() %>% as.numeric(),"poisson"))
broom::glance(MASS::fitdistr(c_4_2005$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(c_4_2005$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, normal has largest logLik and the smallest AIC and BIC. we will pick normal function for cycling trips in 2005!

```{r}
cycling_405_norm <- norm_c4_2005_
c_4_2005 <- c_4_2005 %>%
 mutate(f_4 = dnorm(DURATION, cycling_405_norm$estimate["mean"], cycling_405_norm$estimate["sd"])) 
summary(c_4_2005$f_4)
```

###Destination : Cycling -  Place of worship (5), 2005

The skewness vs. kurtosis graph provides descriptive statistics for cycling trips to Place of worship destinations:

```{r creating Cullen and Frey graph for cycling 2005 - Place of worship (5)}
# creating a skew vs. kurtois graph for cycling 2005- Place of worship

# Filter the data based on the "destination" column
 c_5_2005 <- cycling_2005 %>%
  filter(destination == "5") 
count <- sum(cycling_2005$destination == "5")
print(count)
#descdist(c_5_2005$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```


###Destination :Grocery store, other stores or mall (6 and 7)

The skewness vs. kurtosis graph provides descriptive statistics for cycling trips to grocery store, other stores or mall destinations:

```{r creating Cullen and Frey graph for cycling 2005 - Grocery store, other stores or mall (6 and 7)}
# creating a skew vs. kurtois graph for cycling 2005

# Filter the data based on the "destination" column
 c_6_2005 <- cycling_2005 %>%
  filter(destination %in% c("6", "7"))   
descdist(c_6_2005$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the gamma, poisson, weibull and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_c6_2005_ <- fitdistrplus::fitdist(data=c_6_2005$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(c_6_2005$WGHT_EPI))

fit_dgamma_c605 <- data.frame(f = dgamma(c_6_2005$DURATION, shape = gamma_c6_2005_$estimate[1], rate = gamma_c6_2005_$estimate[2]), x = c_6_2005$DURATION, type = "Gamma")

summary(gamma_c6_2005_)

plot(x= fit_dgamma_c605$x, y=fit_dgamma_c605$f)

#Calculating poisson distribution
pois_c6_2005_ <- fitdistrplus::fitdist(data=c_6_2005$DURATION%>% unlist() %>% as.numeric(), "pois", method="mle", optim.method="Nelder-Mead", weights = round(c_6_2005$WGHT_EPI))

summary(pois_c6_2005_)

fit_dpois_c605 <- data.frame(f = dpois(c_6_2005$DURATION, lambda = pois_c6_2005_$estimate[1]), x = c_6_2005$DURATION, type = "pois")

plot(x= fit_dpois_c605$x, y=fit_dpois_c605$f)

#Calculating exponential distribution
exp_c6_2005_ <- fitdistrplus::fitdist(data=c_6_2005$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(c_6_2005$WGHT_EPI))

summary(exp_c6_2005_)

fit_dexp_c605 <- data.frame(f = dexp(c_6_2005$DURATION, rate = exp_c6_2005_$estimate[1]), 
                       x = c_6_2005$DURATION, type = "exp")

plot(x = fit_dexp_c605$x, y = fit_dexp_c605$f)

#Calculating weibull distribution
weibull_c6_2005_ <- fitdistrplus::fitdist(data=c_6_2005$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(c_6_2005$WGHT_EPI))

summary(weibull_c6_2005_)

fit_dweibull_c605 <- data.frame(f = dweibull(c_6_2005$DURATION, shape = weibull_c6_2005_$estimate[1], scale = weibull_c6_2005_$estimate[2]), x = c_6_2005$DURATION, type = "weibull")

plot(x= fit_dweibull_c605$x, y=fit_dweibull_c605$f)

```

Now let's compare these models AIC and BIC to see which fits the cycling data best:

```{r}
#comparing these models AIC and BIC to see which fits the cycling data best:
broom::glance(MASS::fitdistr(c_6_2005$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(c_6_2005$DURATION%>% unlist() %>% as.numeric(),"poisson"))
broom::glance(MASS::fitdistr(c_6_2005$DURATION%>% unlist() %>% as.numeric(),"exponential"))
broom::glance(MASS::fitdistr(c_6_2005$DURATION%>% unlist() %>% as.numeric(),"weibull"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for cycling trips in 2005!

```{r}
cycling_605_gamma <- gamma_c6_2005_
c_6_2005 <- c_6_2005 %>%
 mutate(f_6 = dgamma(DURATION, cycling_605_gamma$estimate["shape"], cycling_605_gamma$estimate["rate"])) 
summary(c_6_2005$f_6)
```

###Destination : Cycling - Outdoors (9), 2005

The skewness vs. kurtosis graph provides descriptive statistics for walking trips to outdoors destinations:

```{r creating Cullen and Frey graph for cycling 2005 - Outdoors (9)}
# creating a skew vs. kurtois graph for cycling 2005

# Filter the data based on the "destination" column
 c_9_2005 <- cycling_2005 %>%
  filter(destination == "9")   
descdist(c_9_2005$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```


As illustrated in the Cullen and Frey graph, the gamma, normal, weibull, lognormal and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_c9_2005_ <- fitdistrplus::fitdist(data=c_9_2005$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(c_9_2005$WGHT_EPI))

fit_dgamma_c905 <- data.frame(f = dgamma(c_9_2005$DURATION, shape = gamma_c9_2005_$estimate[1], rate = gamma_c9_2005_$estimate[2]), x = c_9_2005$DURATION, type = "Gamma")

summary(gamma_c9_2005_)

plot(x= fit_dgamma_c905$x, y=fit_dgamma_c905$f)

#Calculating exponential distribution
exp_c9_2005_ <- fitdistrplus::fitdist(data=c_9_2005$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(c_9_2005$WGHT_EPI))

summary(exp_c9_2005_)

fit_dexp_c905 <- data.frame(f = dexp(c_9_2005$DURATION, rate = exp_c9_2005_$estimate[1]), 
                       x = c_9_2005$DURATION, type = "exp")

plot(x = fit_dexp_c905$x, y = fit_dexp_c905$f)

#Calculating normal distribution
norm_c9_2005_ <- fitdistrplus::fitdist(data=c_9_2005$DURATION%>% unlist() %>% as.numeric(), "norm", method="mle", optim.method="Nelder-Mead", weights = round(c_9_2005$WGHT_EPI))

summary(norm_c9_2005_)

fit_dnorm_c905 <- data.frame(f = dnorm(c_9_2005$DURATION, mean = norm_c9_2005_$estimate[1], sd = norm_c9_2005_$estimate[2]),  x = c_9_2005$DURATION, type = "norm")

plot(x = fit_dnorm_c905$x, y = fit_dnorm_c905$f)


#Calculating weibull distribution
weibull_c9_2005_ <- fitdistrplus::fitdist(data=c_9_2005$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(c_9_2005$WGHT_EPI))

summary(weibull_c9_2005_)

fit_dweibull_c905 <- data.frame(f = dweibull(c_9_2005$DURATION, shape = weibull_c9_2005_$estimate[1], scale = weibull_c9_2005_$estimate[2]),  x = c_9_2005$DURATION, type = "weibull")

plot(x = fit_dweibull_c905$x, y = fit_dweibull_c905$f)

#Calculating lognormal distribution
lnorm_c9_2005_ <- fitdistrplus::fitdist(data=c_9_2005$DURATION%>% unlist() %>% as.numeric(), "lnorm", method="mle", optim.method="Nelder-Mead", weights = round(c_9_2005$WGHT_EPI))

summary(lnorm_c9_2005_)

fit_dlnorm_c905 <- data.frame(f = dlnorm(c_9_2005$DURATION, meanlog = lnorm_c9_2005_$estimate[1], sdlog = lnorm_c9_2005_$estimate[2]),  x = c_9_2005$DURATION, type = "lnorm")

plot(x = fit_dlnorm_c905$x, y = fit_dlnorm_c905$f)


```

Now let's compare these models AIC and BIC to see which fits the cycling data best:

```{r}
#comparing these models AIC and BIC to see which fits the cycling data best:
broom::glance(MASS::fitdistr(c_9_2005$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(c_9_2005$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(c_9_2005$DURATION%>% unlist() %>% as.numeric(),"lognormal"))
broom::glance(MASS::fitdistr(c_9_2005$DURATION%>% unlist() %>% as.numeric(),"exponential"))
broom::glance(MASS::fitdistr(c_9_2005$DURATION%>% unlist() %>% as.numeric(),"normal"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for cycling trips in 2005!

```{r}
cycling_905_gamma <- gamma_c9_2005_
c_9_2005 <- c_9_2005 %>%
 mutate(f_9 = dgamma(DURATION, cycling_905_gamma$estimate["shape"], cycling_905_gamma$estimate["rate"])) 
summary(c_9_2005$f_9)
```


###Destination : Cycling -Library, museum or theatre (10), 2005

The skewness vs. kurtosis graph provides descriptive statistics for cycling trips to library, museum or theatre destinations:

```{r creating Cullen and Frey graph for cycling 2005 - Library, museum or theatre (10)}
# creating a skew vs. kurtois graph for cycling 2005- Library, museum or theatre

# Filter the data based on the "destination" column
c_10_2005 <- cycling_2005 %>%
  filter(destination == "10")   
count <- sum (cycling_2005$destination == "10")
print (count)

#descdist(c_10_2005$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```


# Final step

In the final step, we constructed a new walking and cycling data frame, "walking_2005_f" and "cycling_2005_f", that contains all the 'f' values for walking and cycling trips in 2005.

Walking trips data frame:

```{r}
walking_2005_f <- bind_rows(w_1_2005, w_2_2005, w_3_2005, w_4_2005, w_5_2005, w_6_2005, w_9_2005, w_10_2005)

```


Cycling trips data frame :

```{r}
cycling_2005_f <- bind_rows(c_1_2005, c_2_2005, c_3_2005,c_4_2005, c_6_2005, c_9_2005)

```


Save these data frames:
```{r}
save(walking_2005_f,
     file = paste0(here(), "/data/walking_2005_f.rda"),
     compress = "bzip2",
     version = 2,
     ascii = FALSE)

save(cycling_2005_f,
     file = paste0(here(), "/data/cycling_2005_f.rda"),
     compress = "bzip2",
     version = 2,
     ascii = FALSE)
```





