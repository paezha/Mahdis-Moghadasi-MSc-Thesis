---
title: "Calculating Walking and cycling trips impedance function- 2015 "
---

# Calculating Walking trips impedance function- 2015

First load all of the libraries

```{r load-packages, include=FALSE, cache=FALSE}
#load all packages:
library(fitdistrplus) # Help to Fit of a Parametric Distribution to Non-Censored or Censored Data
library(tidyverse) # Easily Install and Load the 'Tidyverse'
library(here)
library(dplyr) # A Grammar of Data Manipulation
library(ggplot2) # Create Elegant Data Visualisations Using the Grammar of Graphics
library(readxl) # Read Excel Files 
library(splitstackshape) # Stack and Reshape Datasets After Splitting Concatenated Values
library(tibble) # Simple Data Frames
library(readr) # Read Rectangular Text Data
library(tabulate) # Pretty Console Output for Tables
library(janitor) # Simple Tools for Examining and Cleaning Dirty Data
library(flextable) # Functions for Tabular Reporting
```

Here, the "walking_2015" dataset, which was constructed using the General Social Survey (GSS) dataset for walking trips in 2015, has been loaded.

```{r}
# Load the dataset
load(file = paste0(here(), "/data/walking_2015.Rda"))
```

Initially, we analyzed the travel time variable (DURATION) for 2015. The minimum recorded duration for walking trips is 5 minutes, while the maximum extends to 900 minutes. Furthermore, the average and median duration for walking trips are calculated to be 17.49 minutes and 10 minutes, respectively.

```{r}
walking_2015$DURATION[walking_2015$DURATION == 0] <- 5
summary(walking_2015$DURATION)
```

Subsequently, a weighted histogram was constructed. A histogram serves as a graphical representation that illustrates the frequency distribution of a dataset corresponding to a single variable. Typically, histograms organize data into `bins` or `range groups`, tallying the quantity of data points within each bin. This method effectively visualizes the distribution and variability of the dataset, providing insights into its underlying structure and patterns.

```{r}
ggplot(walking_2015, aes(x = DURATION )) + 
  geom_histogram(binwidth = 30) + 
  geom_vline(aes(xintercept=mean(DURATION)), color="blue", linetype="dashed", linewidth=1)
```

Here, we aim to analyze individuals who engaged in walking for more than 100 minutes, focusing on their origins and destinations. Additionally, we seek to ascertain the number of trips with a DURATION exceeding 100 minutes.

```{r}
walking_2015[walking_2015$DURATION > 100, ]
count_duration <- sum(walking_2015$DURATION > 100)
count_duration
```
As observed, out of 3246 trips, 26 trips exceed 100 minutes in duration. Consequently, we have decided to exclude these trips from our analysis because they are all recreational.

```{r}
walking_2015 <- walking_2015 %>% filter(DURATION < 100)
summary(walking_2015$DURATION)
```

In our analysis to calculate the impedance function, we turned to the `Fitdistrplus` package in R, an essential tool for fitting distributions to data. In the first step, the skewness-kurtosis plot was created. This plot is crucial for pinpointing the Pearson distribution that best matches our data. The process starts with the `descdist` function, which calculates key descriptive statistics like the minimum, maximum, median, mean, standard deviation, skewness, and kurtosis.

Building on the groundwork laid by Cullen and Frey in 1999, our skewness-kurtosis plot helps us scrutinize the empirical distribution of our dataset. This plot clearly demarcates specific values or regions associated with common statistical distributions, aiding us in visually identifying the optimal model for our analysis. Distributions that exhibit fixed skewness and kurtosis values—such as normal, uniform, logistic, and exponential—appear as distinct points on the plot. This feature is particularly handy, as it indicates that data conforming to these distributions will align with those precise points, simplifying the identification process.

However, the plot also caters to distributions like gamma and log-normal, represented as lines, suggesting a variety of potential skewness and kurtosis values they can embody. This aspect is vital for understanding the flexibility these distributions offer when fitting data that may not align perfectly with a single model. Similarly, the beta distribution's broader areas on the plot signify its adaptability in form, accommodating a wider array of data shapes.

This visual tool, enriched by the comparative ease it brings to distribution selection, underscores the value of nuanced data analysis. By integrating these insights, we are better equipped to select the distribution that most accurately reflects the underlying characteristics of our data, enhancing the reliability and precision of our findings.

```{r creating Cullen and Frey graph for walkig 2015}
# creating a skew vs. kurtois graph for walking 2015

descdist(walking_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the gamma and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_w_2015_ <- fitdistrplus::fitdist(data=walking_2015$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(walking_2015$WGHT_EPI))

fit_dgamma <- data.frame(f = dgamma(walking_2015$DURATION, shape = gamma_w_2015_$estimate[1], rate = gamma_w_2015_$estimate[2]), x = walking_2015$DURATION, type = "Gamma")

summary(gamma_w_2015_)

plot(x= fit_dgamma$x, y=fit_dgamma$f)


#Calculating exponential distribution
exp_w_2015_ <- fitdistrplus::fitdist(data=walking_2015$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(walking_2015$WGHT_EPI))

summary(exp_w_2015_)

fit_dexp <- data.frame(f = dexp(walking_2015$DURATION,  exp_w_2015_$estimate[1]), 
                       x = walking_2015$DURATION, type = "exp")

plot(x = fit_dexp$x, y = fit_dexp$f)
```


Now let's compare these models AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walking data best:
broom::glance(MASS::fitdistr(walking_2015$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(walking_2015$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

In the evaluation of different statistical models, we often rely on metrics such as the log-likelihood, Akaike Information Criterion (AIC), and Bayesian Information Criterion (BIC). The log-likelihood provides an estimate of the probability of observing our data under each model, with higher values being preferable. Both the AIC and BIC extend beyond mere goodness of fit, incorporating a penalty for excessive complexity to strike a balance between model accuracy and simplicity. The objective is to identify a model that not only fits the data well but also adheres to the principle of parsimony. Typically, models with lower AIC or BIC values are deemed more desirable.

Upon analysis of the gamma and exponential distribution outputs, it is observed that the gamma distribution achieves a superior log-likelihood and more favorable (lower) AIC and BIC scores. These findings indicate that the gamma distribution provides a closer fit to our data compared to the exponential and weibull distributions, and it does so without introducing undue complexity. In essence, this distribution efficiently encapsulates the core characteristics of our data.


```{r}
walking_2015_gamma <- gamma_w_2015_
walking_2015 <- walking_2015 %>%
 mutate(f = dgamma(DURATION, walking_2015_gamma$estimate["shape"], walking_2015_gamma$estimate["rate"])) 
summary(walking_2015$f)

```


##Calculating Impedance function based on different purposes- walking 2015

###Destination : Walking - Home (300),2015

The skewness vs. kurtosis graph provides descriptive statistics for walking trips to home destinations:

```{r creating Cullen and Frey graph for walkig 2015- Home 300}
# creating a skew vs. kurtois graph for walking 2015-  Home

# Filter the data based on the "destination" column
 w_300_2015 <- walking_2015 %>%
  filter(destination == "300")   
descdist(w_300_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the gamma, weibull and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_w300_2015_ <- fitdistrplus::fitdist(data=w_300_2015$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_300_2015$WGHT_EPI))

fit_dgamma_w30015 <- data.frame(f_300 = dgamma(w_300_2015$DURATION, shape = gamma_w300_2015_$estimate[1], rate = gamma_w300_2015_$estimate[2]), x = w_300_2015$DURATION, type = "Gamma")

summary(gamma_w300_2015_)

plot(x= fit_dgamma_w30015$x, y=fit_dgamma_w30015$f)

#Calculating weibull distribution
weibull_w300_2015_ <- fitdistrplus::fitdist(data=w_300_2015$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(w_300_2015$WGHT_EPI))

summary(weibull_w300_2015_)

fit_dweibull_w30015 <- data.frame(f = dweibull(w_300_2015$DURATION, shape = weibull_w300_2015_$estimate[1], scale = weibull_w300_2015_$estimate[2]), x = w_300_2015$DURATION, type = "weibull")

plot(x= fit_dweibull_w30015$x, y=fit_dweibull_w30015$f)

#Calculating exponential distribution
exp_w300_2015_ <- fitdistrplus::fitdist(data=w_300_2015$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_300_2015$WGHT_EPI))

summary(exp_w300_2015_)

rate_estimate <- exp_w300_2015_$estimate[1]

fit_dexp_w30015 <- data.frame(f = dexp(w_300_2015$DURATION, rate = rate_estimate), 
                       x = w_300_2015$DURATION, type = "exp")

plot(x = fit_dexp_w30015$x, y = fit_dexp_w30015$f)

```

Now let's compare these models AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walking data best:
broom::glance(MASS::fitdistr(w_300_2015$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_300_2015$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(w_300_2015$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for walking trips in 2015!

```{r}
walking_30015_gamma <- gamma_w300_2015_
w_300_2015 <- w_300_2015 %>%
 mutate(f_300 = dgamma(DURATION, walking_30015_gamma$estimate["shape"], walking_30015_gamma$estimate["rate"])) 
summary(w_300_2015$f_300)
```

###Destination : Walking - work or school (301), 2015
The skewness vs. kurtosis graph provides descriptive statistics for walking trips to work or school destinations:

```{r creating Cullen and Frey graph for walkig 2015 - work or school 301}
# creating a skew vs. kurtois graph for walking 2015- work or school

# Filter the data based on the "destination" column
 w_301_2015 <- walking_2015 %>%
  filter(destination == "301")   
descdist(w_301_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```
As illustrated in the Cullen and Frey graph, the gamma, weibull and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 

gamma_w301_2015_ <- fitdistrplus::fitdist(data=w_301_2015$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_301_2015$WGHT_EPI))

fit_dgamma_30115 <- data.frame(f = dgamma(w_301_2015$DURATION, shape = gamma_w301_2015_$estimate[1], rate = gamma_w301_2015_$estimate[2]), x = w_301_2015$DURATION, type = "Gamma")

summary(gamma_w301_2015_)

plot(x= fit_dgamma_30115$x, y=fit_dgamma_30115$f)

#Calculating weibull distribution
weibull_w301_2015_ <- fitdistrplus::fitdist(data=w_301_2015$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(w_301_2015$WGHT_EPI))

summary(weibull_w301_2015_)

fit_dweibull_30115 <- data.frame(f = dweibull(w_301_2015$DURATION, shape = weibull_w301_2015_$estimate[1], scale = weibull_w301_2015_$estimate[2]), x = w_301_2015$DURATION, type = "weibull")

plot(x= fit_dweibull_30115$x, y=fit_dweibull_30115$f)

#Calculating exponential distribution
exp_w301_2015_ <- fitdistrplus::fitdist(data=w_301_2015$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_301_2015$WGHT_EPI))

summary(exp_w301_2015_)
rate_estimate <- exp_w301_2015_$estimate[1]

fit_dexp_30115 <- data.frame(f = dexp(w_301_2015$DURATION, rate = rate_estimate), 
                       x = w_301_2015$DURATION, type = "exp")

plot(x = fit_dexp_30115$x, y = fit_dexp_30115$f)


```

Now let's compare these models AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walking data best:
broom::glance(MASS::fitdistr(w_301_2015$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_301_2015$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(w_301_2015$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for walking trips in 2015!(301)

```{r}
walking_30115_gamma <- gamma_w301_2015_
w_301_2015 <- w_301_2015 %>%
 mutate(f_301 = dgamma(DURATION, walking_30115_gamma$estimate["shape"], walking_30115_gamma$estimate["rate"])) 
summary(w_301_2015$f_301)
```


###Destination : Business (302)
The skewness vs. kurtosis graph provides descriptive statistics for walking trips to Business destinations:

```{r creating Cullen and Frey graph for walkig 2015_ Business destination}
# creating a skew vs. kurtois graph for walking 2015 _ Business destination

# Filter the data based on the "destination" column
 w_302_2015 <- walking_2015 %>%
  filter(destination == "302")   
summary(w_302_2015)

descdist(w_302_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=100)
```
As illustrated in the Cullen and Frey graph, the gamma, poisson and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating pois distribution 
pois_w302_2015_ <- fitdistrplus::fitdist(data=w_302_2015$DURATION%>% unlist() %>% as.numeric(), "pois", method="mle", optim.method="Nelder-Mead", weights = round(w_302_2015$WGHT_EPI))

fit_dpois_30215 <- data.frame(f = dpois(w_302_2015$DURATION, lambda = pois_w302_2015_$estimate[1]), x = w_302_2015$DURATION, type = "pois")

summary(pois_w302_2015_)

plot(x= fit_dpois_30215$x, y=fit_dpois_30215$f)


#Calculating gamma distribution 
gamma_w302_2015_ <- fitdistrplus::fitdist(data=w_302_2015$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_302_2015$WGHT_EPI))

fit_dgamma_30215 <- data.frame(f = dgamma(w_302_2015$DURATION, shape = gamma_w302_2015_$estimate[1], rate = gamma_w302_2015_$estimate[2]), x = w_302_2015$DURATION, type = "gamma")

summary(gamma_w302_2015_)

plot(x= fit_dgamma_30215$x, y=fit_dgamma_30215$f)


#Calculating exponential distribution
exp_w302_2015_ <- fitdistrplus::fitdist(data=w_302_2015$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_302_2015$WGHT_EPI))

summary(exp_w302_2015_)

rate_estimate <- exp_w302_2015_$estimate[1]

fit_dexp_30215 <- data.frame(f = dexp(w_302_2015$DURATION, rate = rate_estimate), x = w_302_2015$DURATION, type = "exp")

plot(x = fit_dexp_30215$x, y = fit_dexp_30215$f)



```

Now let's compare these models AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walking data best:
broom::glance(MASS::fitdistr(w_302_2015$DURATION%>% unlist() %>% as.numeric(),"exponential"))
broom::glance(MASS::fitdistr(w_302_2015$DURATION%>% unlist() %>% as.numeric(),"poisson"))
broom::glance(MASS::fitdistr(w_302_2015$DURATION%>% unlist() %>% as.numeric(),"gamma"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for walking trips in 2015!(302)

```{r}
walking_30215_exp <- exp_w302_2015_
w_302_2015 <- w_302_2015 %>%
 mutate(f_302 = dexp(DURATION, walking_30215_exp$estimate["rate"])) 
summary(w_302_2015$f_302)
```

###Destination : At someone else's home or property (303)
The skewness vs. kurtosis graph provides descriptive statistics for walking trips to other's home destinations:

```{r creating Cullen and Frey graph for walkig 2015 - other home or property (303) }
# creating a skew vs. kurtois graph for walking 2015

# Filter the data based on the "destination" column
 w_303_2015 <- walking_2015 %>%
  filter(destination == "303")   
descdist(w_303_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the gamma, weibull and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 

gamma_w303_2015_ <- fitdistrplus::fitdist(data=w_303_2015$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_303_2015$WGHT_EPI))

fit_dgamma_30315 <- data.frame(f = dgamma(w_303_2015$DURATION, shape = gamma_w303_2015_$estimate[1], rate = gamma_w303_2015_$estimate[2]), x = w_303_2015$DURATION, type = "Gamma")

summary(gamma_w303_2015_)

plot(x= fit_dgamma_30315$x, y=fit_dgamma_30315$f)

#Calculating weibull distribution
weibull_w303_2015_ <- fitdistrplus::fitdist(data=w_303_2015$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(w_303_2015$WGHT_EPI))

summary(weibull_w303_2015_)

fit_dweibull_30315 <- data.frame(f = dweibull(w_303_2015$DURATION, shape = weibull_w303_2015_$estimate[1], scale = weibull_w303_2015_$estimate[2]), x = w_303_2015$DURATION, type = "weibull")

plot(x= fit_dweibull_30315$x, y=fit_dweibull_30315$f)

#Calculating exponential distribution
exp_w303_2015_ <- fitdistrplus::fitdist(data=w_303_2015$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_303_2015$WGHT_EPI))

summary(exp_w303_2015_)

fit_dexp_30315 <- data.frame(f = dexp(w_303_2015$DURATION, rate = exp_w303_2015_$estimate[1]), 
                       x = w_303_2015$DURATION, type = "exp")

plot(x = fit_dexp_30315$x, y = fit_dexp_30315$f)

```

Now let's compare these models AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walking data best:
broom::glance(MASS::fitdistr(w_303_2015$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_303_2015$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(w_303_2015$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for walking trips in 2015!(303)

```{r}
walking_30315_gamma <- gamma_w303_2015_
w_303_2015 <- w_303_2015 %>%
 mutate(f_303 = dgamma(DURATION, walking_30315_gamma$estimate["shape"], walking_30315_gamma$estimate["rate"])) 
summary(w_303_2015$f_303)
```



###Destination : Outdoors (305)
The skewness vs. kurtosis graph provides descriptive statistics for walking trips to Outdoors destinations:

```{r creating Cullen and Frey graph for walkig 2015 - Outdoors (305)}
# creating a skew vs. kurtois graph for walking 2015

# Filter the data based on the "destination" column
 w_305_2015 <- walking_2015 %>%
  filter(destination == "305")   
descdist(w_305_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=1000)
```

As illustrated in the Cullen and Frey graph, the gamma, log-normal, weibull and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 

gamma_w305_2015_ <- fitdistrplus::fitdist(data=w_305_2015$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_305_2015$WGHT_EPI))

fit_dgamma_30515 <- data.frame(f = dgamma(w_305_2015$DURATION, shape = gamma_w305_2015_$estimate[1], rate = gamma_w305_2015_$estimate[2]), x = w_305_2015$DURATION, type = "Gamma")

summary(gamma_w305_2015_)

plot(x= fit_dgamma_30515$x, y=fit_dgamma_30515$f)


#Calculating exponential distribution
exp_w305_2015_ <- fitdistrplus::fitdist(data=w_305_2015$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_305_2015$WGHT_EPI))

summary(exp_w305_2015_)

fit_dexp_30515 <- data.frame(f = dexp(w_305_2015$DURATION, rate = exp_w305_2015_$estimate[1]), 
                       x = w_305_2015$DURATION, type = "exp")

plot(x = fit_dexp_30515$x, y = fit_dexp_30515$f)

#Calculating lognormal distribution 
lnorm_w305_2015_ <- fitdistrplus::fitdist(data=w_305_2015$DURATION%>% unlist() %>% as.numeric(), "lnorm", method="mle", optim.method="Nelder-Mead", weights = round(w_305_2015$WGHT_EPI))

fit_dlnorm_w30515 <- data.frame(f = dlnorm(w_305_2015$DURATION, meanlog = lnorm_w305_2015_$estimate[1], sdlog = lnorm_w305_2015_$estimate[2]), x = w_305_2015$DURATION, type = "lnorm")

summary(lnorm_w305_2015_)

plot(x= fit_dlnorm_w30515$x, y=fit_dlnorm_w30515$f)


#Calculating weibull distribution 
weibull_w305_2015_ <- fitdistrplus::fitdist(data=w_305_2015$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(w_305_2015$WGHT_EPI))

fit_dweibull_30515 <- data.frame(f = dweibull(w_305_2015$DURATION, shape = weibull_w305_2015_$estimate[1], scale = weibull_w305_2015_$estimate[2]), x = w_305_2015$DURATION, type = "weibull")

summary(weibull_w305_2015_)

plot(x= fit_dweibull_30515$x, y=fit_dweibull_30515$f)

```

Now let's compare these models AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walking data best:
broom::glance(MASS::fitdistr(w_305_2015$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_305_2015$DURATION%>% unlist() %>% as.numeric(),"lognormal"))
broom::glance(MASS::fitdistr(w_305_2015$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(w_305_2015$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for walking trips in 2015!(305)

```{r}
walking_30515_gamma <- gamma_w305_2015_
w_305_2015 <- w_305_2015 %>%
 mutate(f_305 = dgamma(DURATION, walking_30515_gamma$estimate["shape"], walking_30515_gamma$estimate["rate"])) 
summary(w_305_2015$f_305)
```



###Destination : Grocery store, other stores or mall (306)
The skewness vs. kurtosis graph provides descriptive statistics for walking trips to grocery store, other stores or mall destinations:

```{r creating Cullen and Frey graph for walkig 2015- Grocery store, other stores or mall (306)}
# creating a skew vs. kurtois graph for walking 2015

# Filter the data based on the "destination" column
 w_306_2015 <- walking_2015 %>%
  filter(destination == "306")   
descdist(w_306_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the gamma, weibull and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 

gamma_w306_2015_ <- fitdistrplus::fitdist(data=w_306_2015$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_306_2015$WGHT_EPI))

fit_dgamma_30615 <- data.frame(f = dgamma(w_306_2015$DURATION, shape = gamma_w306_2015_$estimate[1], rate = gamma_w306_2015_$estimate[2]), x = w_306_2015$DURATION, type = "Gamma")

summary(gamma_w306_2015_)

plot(x= fit_dgamma_30615$x, y=fit_dgamma_30615$f)


#Calculating exponential distribution
exp_w306_2015_ <- fitdistrplus::fitdist(data=w_306_2015$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_306_2015$WGHT_EPI))

summary(exp_w306_2015_)

fit_dexp_30615 <- data.frame(f = dexp(w_306_2015$DURATION, rate = exp_w306_2015_$estimate[1]), 
                       x = w_306_2015$DURATION, type = "exp")

plot(x = fit_dexp_30615$x, y = fit_dexp_30615$f)

#Calculating weibull distribution
weibull_w306_2015_ <- fitdistrplus::fitdist(data=w_306_2015$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(w_306_2015$WGHT_EPI))

summary(weibull_w306_2015_)

fit_dweibull_30615 <- data.frame(f = dweibull(w_306_2015$DURATION, shape = weibull_w306_2015_$estimate[1], scale = weibull_w306_2015_$estimate[2]), x = w_306_2015$DURATION, type = "weibull")

plot(x= fit_dweibull_30615$x, y=fit_dweibull_30615$f)


```

Now let's compare these models AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walking data best:
broom::glance(MASS::fitdistr(w_306_2015$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_306_2015$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(w_306_2015$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for walking trips in 2015!(306)

```{r}
walking_30615_gamma <- gamma_w306_2015_
w_306_2015 <- w_306_2015 %>%
 mutate(f_306 = dgamma(DURATION, walking_30615_gamma$estimate["shape"], walking_30615_gamma$estimate["rate"])) 
summary(w_306_2015$f_306)
```



###Destination : Library, museum or theatre (307)

The skewness vs. kurtosis graph provides descriptive statistics for walking trips to library, museum or theatre destinations:

```{r creating Cullen and Frey graph for walkig 2015 - Library, museum or theatre (307)}
# creating a skew vs. kurtois graph for walking 2015

# Filter the data based on the "destination" column
 w_307_2015 <- walking_2015 %>%
  filter(destination == "307")   
descdist(w_307_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=1000)
```

As illustrated in the Cullen and Frey graph, the gamma, weibull, lognormal and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 

gamma_w307_2015_ <- fitdistrplus::fitdist(data=w_307_2015$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_307_2015$WGHT_EPI))

fit_dgamma_30715 <- data.frame(f = dgamma(w_307_2015$DURATION, shape = gamma_w307_2015_$estimate[1], rate = gamma_w307_2015_$estimate[2]), x = w_307_2015$DURATION, type = "Gamma")

summary(gamma_w307_2015_)

plot(x= fit_dgamma_30715$x, y=fit_dgamma_30715$f)

#Calculating weibull distribution 

weibull_w307_2015_ <- fitdistrplus::fitdist(data=w_307_2015$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(w_307_2015$WGHT_EPI))

fit_dweibull_30715 <- data.frame(f = dweibull(w_307_2015$DURATION, shape = weibull_w307_2015_$estimate[1], scale = weibull_w307_2015_$estimate[2]), x = w_307_2015$DURATION, type = "weibull")

summary(weibull_w307_2015_)

plot(x= fit_dweibull_30715$x, y=fit_dweibull_30715$f)


#Calculating lognormal distribution 

lnorm_w307_2015_ <- fitdistrplus::fitdist(data=w_307_2015$DURATION%>% unlist() %>% as.numeric(), "lnorm", method="mle", optim.method="Nelder-Mead", weights = round(w_307_2015$WGHT_EPI))

fit_dlnorm_30715 <- data.frame(f = dlnorm(w_307_2015$DURATION, meanlog = lnorm_w307_2015_$estimate[1], sdlog = lnorm_w307_2015_$estimate[2]), x = w_307_2015$DURATION, type = "lnorm")

summary(lnorm_w307_2015_)

plot(x= fit_dlnorm_30715$x, y=fit_dlnorm_30715$f)



#Calculating exponential distribution
exp_w307_2015_ <- fitdistrplus::fitdist(data=w_307_2015$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_307_2015$WGHT_EPI))

summary(exp_w307_2015_)

fit_dexp_30715 <- data.frame(f = dexp(w_307_2015$DURATION, rate = exp_w307_2015_$estimate[1]), 
                       x = w_307_2015$DURATION, type = "exp")

plot(x = fit_dexp_30715$x, y = fit_dexp_30715$f)

```

Now let's compare these models AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walking data best:
broom::glance(MASS::fitdistr(w_307_2015$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_307_2015$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(w_307_2015$DURATION%>% unlist() %>% as.numeric(),"lognormal"))
broom::glance(MASS::fitdistr(w_307_2015$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, lognormal has largest logLik and the smallest AIC and BIC. we will pick lognormal function for walking trips in 2015!(307)

```{r}
walking_30715_lnorm <- lnorm_w307_2015_
w_307_2015 <- w_307_2015 %>%
 mutate(f_307 = dlnorm(DURATION, walking_30715_lnorm$estimate["meanlog"], walking_30715_lnorm$estimate["sdlog"])) 
summary(w_307_2015$f_307)
```


###Destination : Restaurant, bar or club (309)
The skewness vs. kurtosis graph provides descriptive statistics for walking trips to restaurant, bar or club destinations:

```{r creating Cullen and Frey graph for walkig 2015- Restaurant, bar or club (309)}
# creating a skew vs. kurtois graph for walking 2015

# Filter the data based on the "destination" column
 w_309_2015 <- walking_2015 %>%
  filter(destination == "309")   

descdist(w_309_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=1000)
```

As illustrated in the Cullen and Frey graph, the gamma and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 

gamma_w309_2015_ <- fitdistrplus::fitdist(data=w_309_2015$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_309_2015$WGHT_EPI))

fit_dgamma_30915 <- data.frame(f = dgamma(w_309_2015$DURATION, shape = gamma_w309_2015_$estimate[1], rate = gamma_w309_2015_$estimate[2]), x = w_309_2015$DURATION, type = "Gamma")

summary(gamma_w309_2015_)

plot(x= fit_dgamma_30915$x, y=fit_dgamma_30915$f)


#Calculating exponential distribution
exp_w309_2015_ <- fitdistrplus::fitdist(data=w_309_2015$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_309_2015$WGHT_EPI))

summary(exp_w309_2015_)

fit_dexp_30915 <- data.frame(f = dexp(w_309_2015$DURATION, rate = exp_w309_2015_$estimate[1]), 
                       x = w_309_2015$DURATION, type = "exp")

plot(x = fit_dexp_30915$x, y = fit_dexp_30915$f)

```

Now let's compare these models AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walking data best:
broom::glance(MASS::fitdistr(w_309_2015$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_309_2015$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for walking trips in 2015!(309)

```{r}
walking_30915_gamma <- gamma_w309_2015_
w_309_2015 <- w_309_2015 %>%
 mutate(f_309 = dgamma(DURATION, walking_30915_gamma$estimate["shape"], walking_30915_gamma$estimate["rate"])) 
summary(w_309_2015$f_309)
```

###Destination : Place of worship (310)
The skewness vs. kurtosis graph provides descriptive statistics for walking trips to place of worship destinations:

```{r creating Cullen and Frey graph for walkig 2015 - Place of worship (310)}
# creating a skew vs. kurtois graph for walking 2015

# Filter the data based on the "destination" column
 w_310_2015 <- walking_2015 %>%
  filter(destination == "310")   

descdist(w_310_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=1000)
```

As illustrated in the Cullen and Frey graph, the gamma, normal, weibull, lognormal and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 

gamma_w310_2015_ <- fitdistrplus::fitdist(data=w_310_2015$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(w_310_2015$WGHT_EPI))

fit_dgamma_31015 <- data.frame(f = dgamma(w_310_2015$DURATION, shape = gamma_w310_2015_$estimate[1], rate = gamma_w310_2015_$estimate[2]), x = w_310_2015$DURATION, type = "Gamma")

summary(gamma_w310_2015_)

plot(x= fit_dgamma_31015$x, y=fit_dgamma_31015$f)


#Calculating exponential distribution
exp_w310_2015_ <- fitdistrplus::fitdist(data=w_310_2015$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(w_310_2015$WGHT_EPI))

summary(exp_w310_2015_)

fit_dexp_31015 <- data.frame(f = dexp(w_310_2015$DURATION, rate = exp_w310_2015_$estimate[1]), 
                       x = w_310_2015$DURATION, type = "exp")

plot(x = fit_dexp_31015$x, y = fit_dexp_31015$f)


#Calculating normal distribution 

norm_w310_2015_ <- fitdistrplus::fitdist(data=w_310_2015$DURATION%>% unlist() %>% as.numeric(), "norm", method="mle", optim.method="Nelder-Mead", weights = round(w_310_2015$WGHT_EPI))

summary(norm_w310_2015_)
fit_dnorm_31015 <- data.frame(f = dnorm(w_310_2015$DURATION, mean = norm_w310_2015_$estimate[1], sd = norm_w310_2015_$estimate[2]), x = w_310_2015$DURATION, type = "norm")

plot(x= fit_dnorm_31015$x, y=fit_dnorm_31015$f)

#Calculating lognormal distribution 

lnorm_w310_2015_ <- fitdistrplus::fitdist(data=w_310_2015$DURATION%>% unlist() %>% as.numeric(), "lnorm", method="mle", optim.method="Nelder-Mead", weights = round(w_310_2015$WGHT_EPI))

summary(lnorm_w310_2015_)
fit_dlnorm_31015 <- data.frame(f = dlnorm(w_310_2015$DURATION, meanlog = lnorm_w310_2015_$estimate[1], sdlog = lnorm_w310_2015_$estimate[2]), x = w_310_2015$DURATION, type = "lnorm")

plot(x= fit_dlnorm_31015$x, y=fit_dlnorm_31015$f)

#Calculating weibull distribution 

weibull_w310_2015_ <- fitdistrplus::fitdist(data=w_310_2015$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(w_310_2015$WGHT_EPI))

summary(weibull_w310_2015_)
fit_dweibull_31015 <- data.frame(f = dweibull(w_310_2015$DURATION, shape = weibull_w310_2015_$estimate[1], scale = weibull_w310_2015_$estimate[2]), x = w_310_2015$DURATION, type = "weibull")

plot(x= fit_dweibull_31015$x, y=fit_dweibull_31015$f)
```

Now let's compare these models AIC and BIC to see which fits the walking data best:

```{r}
#comparing these models AIC and BIC to see which fits the walking data best:
broom::glance(MASS::fitdistr(w_310_2015$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_310_2015$DURATION%>% unlist() %>% as.numeric(),"exponential"))
broom::glance(MASS::fitdistr(w_310_2015$DURATION%>% unlist() %>% as.numeric(),"normal"))
broom::glance(MASS::fitdistr(w_310_2015$DURATION%>% unlist() %>% as.numeric(),"lognormal"))
broom::glance(MASS::fitdistr(w_310_2015$DURATION%>% unlist() %>% as.numeric(),"weibull"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for walking trips in 2015!(310)

```{r}
walking_31015_gamma <- gamma_w310_2015_
w_310_2015 <- w_310_2015 %>%
 mutate(f_310 = dgamma(DURATION, walking_31015_gamma$estimate["shape"], walking_31015_gamma$estimate["rate"])) 
summary(w_310_2015$f_310)
```

# Calculating cycling trips impedance function- 2015

Here, the "cycling_2015" dataset, which was constructed using the General Social Survey (GSS) dataset for cycling trips in 2015, has been loaded.

```{r}
# Load the dataset
load(file = paste0(here(), "/data/cycling_2015.Rda"))
```

Initially, we analyzed the travel time variable (DURATION) for 2015. The minimum recorded duration for cycling trips is 5 minutes, while the maximum extends to 120 minutes. Furthermore, the average and median duration for cycling trips are calculated to be 23.71 minutes and 15 minutes, respectively.

```{r}
summary(cycling_2015$DURATION)
```

Subsequently, a weighted histogram was constructed. A histogram serves as a graphical representation that illustrates the frequency distribution of a dataset corresponding to a single variable. Typically, histograms organize data into `bins` or `range groups`, tallying the quantity of data points within each bin. This method effectively visualizes the distribution and variability of the dataset, providing insights into its underlying structure and patterns.

```{r}
ggplot(cycling_2015, aes(x = DURATION )) + 
  geom_histogram(binwidth = 30) + 
  geom_vline(aes(xintercept=mean(DURATION)), color="blue", linetype="dashed", linewidth=1)
```

Here, we aim to analyze individuals who engaged in cycling for more than 120 minutes, focusing on their origins and destinations. Additionally, we seek to ascertain the number of trips with a DURATION exceeding 120 minutes.

```{r}

count <- sum(cycling_2015$DURATION > 120)
print (count)
```
As observed, out of 245 trips, 0 exceed 120 minutes in duration. 


In our analysis to calculate the impedance function, we turned to the `Fitdistrplus` package in R, an essential tool for fitting distributions to data. In the first step, the skewness-kurtosis plot was created. This plot is crucial for pinpointing the Pearson distribution that best matches our data. The process starts with the `descdist` function, which calculates key descriptive statistics like the minimum, maximum, median, mean, standard deviation, skewness, and kurtosis.

Building on the groundwork laid by Cullen and Frey in 1999, our skewness-kurtosis plot helps us scrutinize the empirical distribution of our dataset. This plot clearly demarcates specific values or regions associated with common statistical distributions, aiding us in visually identifying the optimal model for our analysis. Distributions that exhibit fixed skewness and kurtosis values—such as normal, uniform, logistic, and exponential—appear as distinct points on the plot. This feature is particularly handy, as it indicates that data conforming to these distributions will align with those precise points, simplifying the identification process.

However, the plot also caters to distributions like gamma and lognormal, represented as lines, suggesting a variety of potential skewness and kurtosis values they can embody. This aspect is vital for understanding the flexibility these distributions offer when fitting data that may not align perfectly with a single model. Similarly, the beta distribution's broader areas on the plot signify its adaptability in form, accommodating a wider array of data shapes.

This visual tool, enriched by the comparative ease it brings to distribution selection, underscores the value of nuanced data analysis. By integrating these insights, we are better equipped to select the distribution that most accurately reflects the underlying characteristics of our data, enhancing the reliability and precision of our findings.


```{r creating Cullen and Frey graph for cycling 2015}
# creating a skew vs. kurtois graph for cycling 2015

descdist(cycling_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=1000)
```

As illustrated in the Cullen and Frey graph, the gamma, weibull and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.


```{r}

# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution

gamma_c_2015_ <- fitdistrplus::fitdist(data=cycling_2015$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(cycling_2015$WGHT_EPI))


fit_dgamma <- data.frame(f = dgamma(cycling_2015$DURATION, shape = gamma_c_2015_$estimate[1], rate = gamma_c_2015_$estimate[2]), x = cycling_2015$DURATION, type = "gamma")

summary(gamma_c_2015_)

plot(x= fit_dgamma$x, y=fit_dgamma$f)


#Calculating weibul distribution

weibull_c_2015_ <- fitdistrplus::fitdist(data=cycling_2015$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(cycling_2015$WGHT_EPI))


fit_dweibull <- data.frame(f = dweibull(cycling_2015$DURATION, shape = weibull_c_2015_$estimate[1], scale = weibull_c_2015_$estimate[2]), x = cycling_2015$DURATION, type = "weibull")

summary(weibull_c_2015_)

plot(x= fit_dweibull$x, y=fit_dweibull$f)


#Calculating exponential distribution
exp_c_2015_ <- fitdistrplus::fitdist(data=cycling_2015$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(cycling_2015$WGHT_EPI))

summary(exp_c_2015_)

fit_dexp <- data.frame(f = dexp(cycling_2015$DURATION, rate = exp_c_2015_$estimate[1]), x = cycling_2015$DURATION, type = "exp")

plot(x= fit_dexp$x, y=fit_dexp$f)


```

Now let's compare these models based on AIC and BIC to see which fits the cycling data best:

```{r}
#comparing these models AIC and BIC to see which fits the cycling data best:
broom::glance(MASS::fitdistr(cycling_2015$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(cycling_2015$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(cycling_2015$DURATION%>% unlist() %>% as.numeric(),"exponential"))

```

In the evaluation of different statistical models, we often rely on metrics such as the log-likelihood, Akaike Information Criterion (AIC), and Bayesian Information Criterion (BIC). The log-likelihood provides an estimate of the probability of observing our data under each model, with higher values being preferable. Both the AIC and BIC extend beyond mere goodness of fit, incorporating a penalty for excessive complexity to strike a balance between model accuracy and simplicity. The objective is to identify a model that not only fits the data well but also adheres to the principle of parsimony. Typically, models with lower AIC or BIC values are deemed more desirable.

Upon analysis of the gamma, weibull and exponential distribution outputs, it is observed that the gamma distribution achieves a superior log-likelihood and more favorable (lower) AIC and BIC scores. These findings indicate that the gamma distribution provides a closer fit to our data compared to the weibull and exponential distributions, and it does so without introducing undue complexity. In essence, this distribution efficiently encapsulates the core characteristics of our data.

```{r}
cycling_2015_gamma <- gamma_c_2015_
cycling_2015 <- cycling_2015 %>%
 mutate(f = dgamma(DURATION, cycling_2015_gamma$estimate["shape"], cycling_2015_gamma$estimate["rate"] )) 
summary(cycling_2015$f)

```


###Destination : Cycling- Home (300), 2015

The skewness vs. kurtosis graph provides descriptive statistics for cycling trips to home destinations:

```{r creating Cullen and Frey graph for cycling 2015 - Home (300)}
# creating a skew vs. kurtois graph for cycling 2015

# Filter the data based on the "destination" column
 c_300_2015 <- cycling_2015 %>%
  filter(destination == "300")   
descdist(c_300_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```
As illustrated in the Cullen and Frey graph, the gamma, weibull and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 
gamma_c300_2015_ <- fitdistrplus::fitdist(data=c_300_2015$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(c_300_2015$WGHT_EPI))

fit_dgamma_c30015 <- data.frame(f_300 = dgamma(c_300_2015$DURATION, shape = gamma_c300_2015_$estimate[1], rate = gamma_c300_2015_$estimate[2]), x = c_300_2015$DURATION, type = "Gamma")

summary(gamma_c300_2015_)

plot(x= fit_dgamma_c30015$x, y=fit_dgamma_c30015$f)

#Calculating weibull distribution
weibull_c300_2015_ <- fitdistrplus::fitdist(data=c_300_2015$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(c_300_2015$WGHT_EPI))

summary(weibull_c300_2015_)

fit_dweibull_c30015 <- data.frame(f = dweibull(c_300_2015$DURATION, shape = weibull_c300_2015_$estimate[1], scale = weibull_c300_2015_$estimate[2]), x = c_300_2015$DURATION, type = "weibull")

plot(x= fit_dweibull_c30015$x, y=fit_dweibull_c30015$f)

#Calculating exponential distribution
exp_c300_2015_ <- fitdistrplus::fitdist(data=c_300_2015$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(c_300_2015$WGHT_EPI))

summary(exp_c300_2015_)

fit_dexp_c30015 <- data.frame(f = dexp(c_300_2015$DURATION, exp_c300_2015_$estimate[1]), 
                       x = c_300_2015$DURATION, type = "exp")

plot(x = fit_dexp_c30015$x, y = fit_dexp_c30015$f)

```

Now let's compare these models AIC and BIC to see which fits the cycling data best:

```{r}
#comparing these models AIC and BIC to see which fits the cycling data best:
broom::glance(MASS::fitdistr(c_300_2015$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(c_300_2015$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(c_300_2015$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for cycling trips in 2015!

```{r}
cycling_30015_gamma <- gamma_c300_2015_
c_300_2015 <- c_300_2015 %>%
 mutate(f_300 = dgamma(DURATION, cycling_30015_gamma$estimate["shape"], cycling_30015_gamma$estimate["rate"])) 
summary(c_300_2015$f_300)
```



###Destination : Cycling - work or school (301), 2015
The skewness vs. kurtosis graph provides descriptive statistics for cycling trips to work or school destinations:

```{r creating Cullen and Frey graph for cycling 2015 - work or school (301)}
# creating a skew vs. kurtois graph for cycling 2015

# Filter the data based on the "destination" column
 c_301_2015 <- cycling_2015 %>%
  filter(destination == "301")   
descdist(c_301_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```
As illustrated in the Cullen and Frey graph, the ggamma, weibull, normal, lognormal and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 

gamma_c301_2015_ <- fitdistrplus::fitdist(data=c_301_2015$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(c_301_2015$WGHT_EPI))

fit_dgamma_30115 <- data.frame(f = dgamma(c_301_2015$DURATION, shape = gamma_c301_2015_$estimate[1], rate = gamma_c301_2015_$estimate[2]), x = c_301_2015$DURATION, type = "Gamma")

summary(gamma_c301_2015_)

plot(x= fit_dgamma_30115$x, y=fit_dgamma_30115$f)

#Calculating weibull distribution
weibull_c301_2015_ <- fitdistrplus::fitdist(data=c_301_2015$DURATION%>% unlist() %>% as.numeric(), "weibull", method="mle", optim.method="Nelder-Mead", weights = round(c_301_2015$WGHT_EPI))

summary(weibull_c301_2015_)

fit_dweibull_30115 <- data.frame(f = dweibull(c_301_2015$DURATION, shape = weibull_c301_2015_$estimate[1], scale = weibull_c301_2015_$estimate[2]), x = c_301_2015$DURATION, type = "weibull")

plot(x= fit_dweibull_30115$x, y=fit_dweibull_30115$f)

#Calculating exponential distribution
exp_c301_2015_ <- fitdistrplus::fitdist(data=c_301_2015$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(c_301_2015$WGHT_EPI))

summary(exp_c301_2015_)

fit_dexp_30115 <- data.frame(f = dexp(w_301_2015$DURATION, rate =exp_w301_2015_$estimate[1]), 
                       x = w_301_2015$DURATION, type = "exp")

plot(x = fit_dexp_30115$x, y = fit_dexp_30115$f)

#Calculating normal distribution
norm_c301_2015_ <- fitdistrplus::fitdist(data=c_301_2015$DURATION%>% unlist() %>% as.numeric(), "norm", method="mle", optim.method="Nelder-Mead", weights = round(c_301_2015$WGHT_EPI))

summary(norm_c301_2015_)

fit_dnorm_30115 <- data.frame(f = dnorm(c_301_2015$DURATION, mean = norm_c301_2015_$estimate[1], sd = norm_c301_2015_$estimate[2]), x = c_301_2015$DURATION, type = "norm")

plot(x= fit_dnorm_30115$x, y=fit_dnorm_30115$f)

#Calculating lognormal distribution
lnorm_c301_2015_ <- fitdistrplus::fitdist(data=c_301_2015$DURATION%>% unlist() %>% as.numeric(), "lnorm", method="mle", optim.method="Nelder-Mead", weights = round(c_301_2015$WGHT_EPI))

summary(lnorm_c301_2015_)

fit_dlnorm_30115 <- data.frame(f = dlnorm(c_301_2015$DURATION, meanlog = lnorm_c301_2015_$estimate[1], sdlog = lnorm_c301_2015_$estimate[2]), x = c_301_2015$DURATION, type = "lnorm")

plot(x= fit_dlnorm_30115$x, y=fit_dlnorm_30115$f)
```

Now let's compare these models AIC and BIC to see which fits the cycling data best:

```{r}
#comparing these models AIC and BIC to see which fits the cycling data best:
broom::glance(MASS::fitdistr(c_301_2015$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(c_301_2015$DURATION%>% unlist() %>% as.numeric(),"weibull"))
broom::glance(MASS::fitdistr(c_301_2015$DURATION%>% unlist() %>% as.numeric(),"exponential"))
broom::glance(MASS::fitdistr(c_301_2015$DURATION%>% unlist() %>% as.numeric(),"normal"))
broom::glance(MASS::fitdistr(c_301_2015$DURATION%>% unlist() %>% as.numeric(),"lognormal"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for cycling trips in 2015!(301)

```{r}
cycling_30115_gamma <- gamma_c301_2015_
c_301_2015 <- c_301_2015 %>%
 mutate(f_301 = dgamma(DURATION, cycling_30115_gamma$estimate["shape"], cycling_30115_gamma$estimate["rate"])) 
summary(c_301_2015$f_301)
```


###Destination : Cycling- Business (302), 2015

The skewness vs. kurtosis graph provides descriptive statistics for cycling trips to Business destinations:

```{r creating Cullen and Frey graph for cycling 2015_ Business (302)}
# creating a skew vs. kurtois graph for cycling 2015 _ Business destination

# Filter the data based on the "destination" column
 c_302_2015 <- cycling_2015 %>%
  filter(destination == "302") 
count <- sum(cycling_2015$destination == "302")
print(count)

```

There is no available data pertaining to cycling directed towards business destinations.

###Destination : Cycling- At someone else's home or property (303), 2015

The skewness vs. kurtosis graph provides descriptive statistics for cycling trips to other's home destinations:


```{r creating Cullen and Frey graph for cycling 2015 - At someone else home or property (303)}
# creating a skew vs. kurtois graph for cycling 2015

# Filter the data based on the "destination" column
 c_303_2015 <- cycling_2015 %>%
  filter(destination == "303")   

descdist(c_303_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the gamma, poisson, normal and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 

gamma_c303_2015_ <- fitdistrplus::fitdist(data=c_303_2015$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(c_303_2015$WGHT_EPI))

fit_dgamma_30315 <- data.frame(f = dgamma(c_303_2015$DURATION, shape = gamma_c303_2015_$estimate[1], rate = gamma_c303_2015_$estimate[2]), x = c_303_2015$DURATION, type = "Gamma")

summary(gamma_c303_2015_)

plot(x= fit_dgamma_30315$x, y=fit_dgamma_30315$f)


#Calculating exponential distribution
exp_c303_2015_ <- fitdistrplus::fitdist(data=c_303_2015$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(c_303_2015$WGHT_EPI))

summary(exp_c303_2015_)

fit_dexp_30315 <- data.frame(f = dexp(c_303_2015$DURATION, rate = exp_c303_2015_$estimate[1]), 
                       x = c_303_2015$DURATION, type = "exp")

plot(x = fit_dexp_30315$x, y = fit_dexp_30315$f)

#Calculating pois distribution 
pois_c303_2015_ <- fitdistrplus::fitdist(data=c_303_2015$DURATION%>% unlist() %>% as.numeric(), "pois", method="mle", optim.method="Nelder-Mead", weights = round(c_303_2015$WGHT_EPI))

fit_dpois_30315 <- data.frame(f = dpois(c_303_2015$DURATION, lambda = pois_c303_2015_$estimate[1]), x = c_303_2015$DURATION, type = "pois")

summary(pois_c303_2015_)

plot(x= fit_dpois_30315$x, y=fit_dpois_30315$f)

#Calculating normal distribution 
norm_c303_2015_ <- fitdistrplus::fitdist(data=c_303_2015$DURATION%>% unlist() %>% as.numeric(), "norm", method="mle", optim.method="Nelder-Mead", weights = round(c_303_2015$WGHT_EPI))

fit_dnorm_30315 <- data.frame(f = dnorm(c_303_2015$DURATION, mean = norm_c303_2015_$estimate[1], sd = norm_c303_2015_$estimate[2]), x = c_303_2015$DURATION, type = " norm")

summary(norm_c303_2015_)

plot(x= fit_dnorm_30315$x, y=fit_dnorm_30315$f)

```

Now let's compare these models AIC and BIC to see which fits the cycling data best:

```{r}
#comparing these models AIC and BIC to see which fits the cycling data best:
broom::glance(MASS::fitdistr(c_303_2015$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(c_303_2015$DURATION%>% unlist() %>% as.numeric(),"poisson"))
broom::glance(MASS::fitdistr(c_303_2015$DURATION%>% unlist() %>% as.numeric(),"exponential"))
broom::glance(MASS::fitdistr(c_303_2015$DURATION%>% unlist() %>% as.numeric(),"normal"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for cycling trips in 2015!(303)

```{r}
cycling_30315_gamma <- gamma_c303_2015_
c_303_2015 <- c_303_2015 %>%
 mutate(f_303 = dgamma(DURATION, cycling_30315_gamma$estimate["shape"], cycling_30315_gamma$estimate["rate"])) 
summary(c_303_2015$f_303)
```



###Destination : Cycling - Outdoors (305), 2015
The skewness vs. kurtosis graph provides descriptive statistics for cycling trips to Outdoors destinations:

```{r creating Cullen and Frey graph for cycling 2015 - Outdoors (305)}
# creating a skew vs. kurtois graph for cycling 2015

# Filter the data based on the "destination" column
 c_305_2015 <- cycling_2015 %>%
  filter(destination == "305") 

count <- sum(cycling_2015$destination == "305")
print(count)

#descdist(c_305_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```
There is no available data pertaining to cycling directed towards Outdoors destinations.


###Destination : Cycling - Grocery store, other stores or mall (306), 2015
The skewness vs. kurtosis graph provides descriptive statistics for cycling trips to grocery store, other stores or mall destinations:

```{r creating Cullen and Frey graph for cycling 2015- Grocery store, other stores or mall (306)}
# creating a skew vs. kurtois graph for cycling 2015

# Filter the data based on the "destination" column
 c_306_2015 <- cycling_2015 %>%
  filter(destination == "306")   
descdist(c_306_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the normal, gamma, lognormal and logistic distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating normal distribution 

norm_c306_2015_ <- fitdistrplus::fitdist(data=c_306_2015$DURATION%>% unlist() %>% as.numeric(), "norm", method="mle", optim.method="Nelder-Mead", weights = round(c_306_2015$WGHT_EPI))

summary(norm_c306_2015_)

fit_dnorm_30615 <- data.frame(f = dnorm(c_306_2015$DURATION, mean = norm_c306_2015_$estimate[1], sd = norm_c306_2015_$estimate[2]), x = c_306_2015$DURATION, type = "norm")

plot(x= fit_dnorm_30615$x, y=fit_dnorm_30615$f)

#Calculating lognormal distribution 

lnorm_c306_2015_ <- fitdistrplus::fitdist(data=c_306_2015$DURATION%>% unlist() %>% as.numeric(), "lnorm", method="mle", optim.method="Nelder-Mead", weights = round(c_306_2015$WGHT_EPI))

summary(lnorm_c306_2015_)

fit_dlnorm_30615 <- data.frame(f = dlnorm(c_306_2015$DURATION, meanlog = lnorm_c306_2015_$estimate[1], sdlog = lnorm_c306_2015_$estimate[2]), x = c_306_2015$DURATION, type = "lnorm")

plot(x= fit_dlnorm_30615$x, y=fit_dlnorm_30615$f)

#Calculating gamma distribution 

gamma_c306_2015_ <- fitdistrplus::fitdist(data=c_306_2015$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(c_306_2015$WGHT_EPI))

summary(gamma_c306_2015_)

fit_dgamma_30615 <- data.frame(f = dgamma(c_306_2015$DURATION, shape = gamma_c306_2015_$estimate[1], rate = gamma_c306_2015_$estimate[2]), x = c_306_2015$DURATION, type = "gamma")

plot(x= fit_dgamma_30615$x, y=fit_dgamma_30615$f)

#Calculating logistic distribution
logis_c306_2015_ <- fitdistrplus::fitdist(data=c_306_2015$DURATION%>% unlist() %>% as.numeric(), "logis", method="mle", optim.method="Nelder-Mead", weights = round(c_306_2015$WGHT_EPI))

summary(logis_c306_2015_)

fit_dlogis_30615 <- data.frame(f = dlogis(c_306_2015$DURATION, location = logis_c306_2015_$estimate[1], scale = logis_c306_2015_$estimate[2]), x = c_306_2015$DURATION, type = "logis")

plot(x= fit_dlogis_30615$x, y=fit_dlogis_30615$f)


```

Now let's compare these models AIC and BIC to see which fits the cycling data best:

```{r}
#comparing these models AIC and BIC to see which fits the cycling data best:
broom::glance(MASS::fitdistr(w_306_2015$DURATION%>% unlist() %>% as.numeric(),"logistic"))
broom::glance(MASS::fitdistr(w_306_2015$DURATION%>% unlist() %>% as.numeric(),"lognormal"))
broom::glance(MASS::fitdistr(w_306_2015$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_306_2015$DURATION%>% unlist() %>% as.numeric(),"normal"))
```

So, lognormal has largest logLik and the smallest AIC and BIC. we will pick lognormal function for walking trips in 2015!(306)

```{r}
cycling_30615_lnorm <- lnorm_c306_2015_
c_306_2015 <- c_306_2015 %>%
 mutate(f_306 = dlnorm(DURATION, cycling_30615_lnorm$estimate["meanlog"], cycling_30615_lnorm$estimate["sdlog"])) 
summary(c_306_2015$f_306)
```



###Destination : Cycling - Library, museum or theatre (307), 2015

The skewness vs. kurtosis graph provides descriptive statistics for cycling trips to library, museum or theatre destinations:

```{r creating Cullen and Frey graph for cycling 2015 - Library, museum or theatre (307)}
# creating a skew vs. kurtois graph for cycling 2015

# Filter the data based on the "destination" column
 c_307_2015 <- cycling_2015 %>%
  filter(destination == "307")  
count <- sum(cycling_2015$destination == "307")
print(count)

#descdist(c_307_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

There is no available data pertaining to cycling directed towards library, museum or theatre destinations.

###Destination : Cycling - Restaurant, bar or club (309), 2015
The skewness vs. kurtosis graph provides descriptive statistics for cycling trips to restaurant, bar or club destinations:

```{r creating Cullen and Frey graph for cycling 2015 - Restaurant, bar or club (309)}
# creating a skew vs. kurtois graph for cycling 2015

# Filter the data based on the "destination" column
 c_309_2015 <- cycling_2015 %>%
  filter(destination == "309")   

descdist(c_309_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

As illustrated in the Cullen and Frey graph, the gamma, normal, poisson and exponential distributions appear to be the most suitable fits according to the aforementioned graph. Subsequently, we will conduct a comparative analysis of these models to ascertain the optimal model.

```{r}
# Based on the skew vs. kurtois graph the best distribution

#Calculating gamma distribution 

gamma_c309_2015_ <- fitdistrplus::fitdist(data=c_309_2015$DURATION%>% unlist() %>% as.numeric(), "gamma", method="mle", optim.method="Nelder-Mead", weights = round(c_309_2015$WGHT_EPI))

fit_dgamma_30915 <- data.frame(f = dgamma(c_309_2015$DURATION, shape = gamma_c309_2015_$estimate[1], rate = gamma_c309_2015_$estimate[2]), x = c_309_2015$DURATION, type = "Gamma")

summary(gamma_c309_2015_)

plot(x= fit_dgamma_30915$x, y=fit_dgamma_30915$f)

#Calculating pois distribution 
pois_c309_2015_ <- fitdistrplus::fitdist(data=c_309_2015$DURATION%>% unlist() %>% as.numeric(), "pois", method="mle", optim.method="Nelder-Mead", weights = round(c_309_2015$WGHT_EPI))

fit_dpois_30915 <- data.frame(f = dpois(c_309_2015$DURATION, lambda = pois_c309_2015_$estimate[1]), x = c_309_2015$DURATION, type = "pois")

summary(pois_c309_2015_)

plot(x= fit_dpois_30915$x, y=fit_dpois_30915$f)


#Calculating normal distribution
norm_c309_2015_ <- fitdistrplus::fitdist(data=c_309_2015$DURATION%>% unlist() %>% as.numeric(), "norm", method="mle", optim.method="Nelder-Mead", weights = round(c_309_2015$WGHT_EPI))

summary(norm_c309_2015_)

fit_dnorm_30915 <- data.frame(f = dnorm(c_309_2015$DURATION, mean = norm_c309_2015_$estimate[1], sd = norm_c309_2015_$estimate[2]), x = c_309_2015$DURATION, type = "norm")

plot(x= fit_dnorm_30915$x, y=fit_dnorm_30915$f)


#Calculating exponential distribution
exp_c309_2015_ <- fitdistrplus::fitdist(data=c_309_2015$DURATION%>% unlist() %>% as.numeric(), "exp", method="mle", optim.method="Nelder-Mead", weights = round(c_309_2015$WGHT_EPI))

summary(exp_c309_2015_)

fit_dexp_30915 <- data.frame(f = dexp(c_309_2015$DURATION, rate = exp_c309_2015_$estimate[1]), 
                       x = c_309_2015$DURATION, type = "exp")

plot(x = fit_dexp_30915$x, y = fit_dexp_30915$f)

```

Now let's compare these models AIC and BIC to see which fits the cycling data best:

```{r}
#comparing these models AIC and BIC to see which fits the cycling data best:
broom::glance(MASS::fitdistr(w_309_2015$DURATION%>% unlist() %>% as.numeric(),"gamma"))
broom::glance(MASS::fitdistr(w_309_2015$DURATION%>% unlist() %>% as.numeric(),"normal"))
broom::glance(MASS::fitdistr(w_309_2015$DURATION%>% unlist() %>% as.numeric(),"poisson"))
broom::glance(MASS::fitdistr(w_309_2015$DURATION%>% unlist() %>% as.numeric(),"exponential"))
```

So, gamma has largest logLik and the smallest AIC and BIC. we will pick gamma function for walking trips in 2015!(309)

```{r}
cycling_30915_gamma <- gamma_c309_2015_
c_309_2015 <- c_309_2015 %>%
 mutate(f_309 = dgamma(DURATION, cycling_30915_gamma$estimate["shape"], cycling_30915_gamma$estimate["rate"])) 
summary(c_309_2015$f_309)
```

###Destination : Cycling - Place of worship (310), 2015
The skewness vs. kurtosis graph provides descriptive statistics for cycling trips to home destinations:

```{r creating Cullen and Frey graph for cycling 2015 - Place of worship (310)}
# creating a skew vs. kurtois graph for cycling 2015

# Filter the data based on the "destination" column
 c_310_2015 <- cycling_2015 %>%
  filter(destination == "310")  
count <- sum(cycling_2015$destination == "310")
print(count)


#descdist(c_310_2015$DURATION %>% unlist() %>% as.numeric(), discrete=FALSE, boot=500)
```

There is no available data pertaining to cycling directed towards place of worship destinations.






# Final step

In the final step, we constructed a new walking and cycling data frame, "walking_2015_f" and "cycling_2015_f", that contains all the 'f' values for walking and cycling trips in 2015.

Walking trips data frame:
```{r}
walking_2015_f <- bind_rows(w_300_2015, w_301_2015, w_302_2015, w_303_2015, w_305_2015, w_306_2015, w_307_2015, w_309_2015, w_310_2015)

```


Cycling trips data frame :
```{r}
cycling_2015_f <- bind_rows(c_300_2015, c_301_2015, c_302_2015, c_303_2015, c_305_2015, c_306_2015,  c_309_2015)

```


Save these data frames:
```{r}
save(walking_2015_f,
     file = paste0(here(), "/data/walking_2015_f.Rda"),
     compress = "bzip2",
     version = 2,
     ascii = FALSE)

save(cycling_2015_f,
     file = paste0(here(), "/data/cycling_2015_f.Rda"),
     compress = "bzip2",
     version = 2,
     ascii = FALSE)
```











