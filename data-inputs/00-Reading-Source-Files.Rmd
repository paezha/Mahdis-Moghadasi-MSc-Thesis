---
title: "R Notebook"
---

Begin by loading the packages used in this notebook: 
```{r}
library(dplyr) # A Grammar of Data Manipulation
library(ggplot2) # Create Elegant Data Visualisations Using the Grammar of Graphics
library(here) # A Simpler Way to Find Your Files
library(readxl) # Read Excel Files
library(tidyr) # Tidy Messy Data
library(usethis) # Automate Package and Project Setup
library(fitdistrplus)
library(purrr)
```


## Source Files

In Canada, a survey program is run by Statistics Canada called General Social Surveys, or GSS for short. GSS collects data on social trends in order to track changes in Canadians' living conditions and well-being over time, as well as to provide immediate information on specific social policy issues of current or emerging interest. This survey tracks changes in time used to better understand how Canadians spend and manage their time and what factors contribute to their happiness and stress. This program in Canada was established in 1985 as a series of independent, annual, cross-sectional surveys, each covering one topic in depth. Caregiving, families, time use, social identity, volunteering, and victimization are among the current GSS themes.

The six survey themes listed above are thoroughly repeated every five years. In addition to the core topic, each cycle includes new content that addresses emerging, policy-relevant issues. In addition, each survey collects detailed socio-demographic information such as age, gender, education, religion, ethnicity, income, etc.

Time-use surveys gather data on all human activities and can thus inform a wide range of policies. In particular, three key themes have been identified as essential for informed policymaking and for which no other data sources are adequate: unpaid work and non-market production, well-being, and gender equality. Leisure time, work-life balance, health, commuting, culture, and sports are among the other topics covered by time-use surveys. In addition, statistics Canada has been conducting time-use surveys at five- to seven-year intervals since 1986, most recently in 2015 (1986,1992,1998, 2005,2010, and 2015). This means that there is information about time use patterns covering a period of so many years.
The GSS on time use collects information on respondents' participation in, and time spent on, a wide range of day-to-day activities using a retrospective 24-hour time diary. Furthermore, information is gathered on the location of these activities (e.g., at home, at work, etc.) and, for non-personal activities, the people who were present with the respondent at the time of the activity.


The surveys (obtained from [here](http://odesi2.scholarsportal.info/webview/)) consist of two files: a main file and an episode file. These are their characteristics.

**The main file** : The Main File from the referenced survey compiles an extensive array of aggregated data, summarizing the answers to the questionnaire and derived variables that summarize the respondents' time use across various activities, locations, and social interactions. This file methodically documents the total time respondents allocate to distinct activities, the aggregate time spent at different locations, and the cumulative duration of engagement with various individuals. While providing a comprehensive overview of daily routines and social dynamics, the Main File does not delve into the specifics of individual activity episodes, offering instead a macro-level perspective of time use patterns.

Furthermore, this file categorizes activities into significant groups and subcategories, enhancing the data's analytical utility with additional metrics such as total transit time, duration spent with household members, and counts of activities and episodes. Notably, the Main File's data aggregation prohibits directly associating specific activities with particular locations or companions, a level of detail reserved for the Episode File. As such, the Main File is a crucial resource for comprehensive analyses, establishing a contextual foundation for the detailed analysis available through the Episode File, thereby enhancing both the cohesion and coherence of research endeavors in time-use studies.

**The episode file**: The Episode File from the GSS survey meticulously records detailed data for each activity episode reported by respondents, providing granular insights into daily activities. Each episode entry includes the start and end times, duration, location, and accompanying social context, delineating when and where activities occurred and with whom. The file distinguishes itself by focusing on individual episodes rather than respondents, with the data structured around the numerous activity instances—333,654 records in total—that compose a respondent's day.

This file is unique in that it arranges contact details according to variables particular to each interaction that occurs within an episode, guaranteeing a thorough recording of social interactions. Although respondent-specific characteristics are not included within the Episode File, linkage to the Main File via the RECID enables the integration of episode-specific data with respondent demographics for richer analyses. 

For the purpose of this notebook, the following definitions are important:

| **Code** 	| **Location**                             	| **Year** 	| **Description**                                                 	|
|----------	|------------------------------------------	|----------	|-----------------------------------------------------------------	|
|    300   	| At home or on property                   	|   2015   	| Walking (code = 315) and Cycling (code = 318) to this location  	|
|    301   	| At place of work or school               	|   2015   	| Walking (code = 315) and Cycling (code = 318) to this location  	|
|   302    	| Away on business                         	|   2015   	| Walking (code = 315) and Cycling (code = 318) to this location  	|
|    303   	| At someone else's home or property       	|   2015   	| Walking (code = 315) and Cycling (code = 318) to this location  	|
|    304   	| In the neighbourhood                     	|   2015   	| Walking (code = 315) and Cycling (code = 318) to this location  	|
|    305   	| Outdoors                                 	|   2015   	| Walking (code = 315) and Cycling (code = 318) to this location  	|
|    306   	| Grocery store, other stores or mall      	|   2015   	| Walking (code = 315) and Cycling (code = 318) to this location  	|
|    307   	| Library, museum or theatre               	|   2015   	| Walking (code = 315) and Cycling (code = 318) to this location  	|
|    308   	| Sports centre, field or arena            	|   2015   	| Walking (code = 315) and Cycling (code = 318) to this location  	|
|    309   	| Restaurant, bar or club                  	|   2015   	| Walking (code = 315) and Cycling (code = 318) to this location  	|
|    310   	| Place of worship                         	|   2015   	| Walking (code = 315) and Cycling (code = 318) to this location  	|
|    311   	| Medical, dental or other health   clinic 	|   2015   	| Walking (code = 315) and Cycling (code = 318) to this location  	|
|    312   	| Elsewhere                                	|   2015   	| Walking (code = 315) and Cycling (code = 318) to this location  	|
|     1    	| R's home                                 	|   2010   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|     2    	| Work place                               	|   2010   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|     3    	| Someone else's home                      	|   2010   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|     4    	| Restaurant/bar                           	|   2010   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|     5    	| Place of worship                         	|   2010   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|     6    	| Grocery store                            	|   2010   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|     7    	| Other store/Mall                         	|   2010   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|     8    	| School                                   	|   2010   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|     9    	| Outdoors away from   home                	|   2010   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|    10    	| Library                                  	|   2010   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|    11    	| Other place                              	|   2010   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|     1    	| Respondent's home                        	|   2005   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|     2    	| Work place                               	|   2005   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|     3    	| Someone else's home                      	|   2005   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|     4    	| Restaurant/bar                           	|   2005   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|     5    	| Place of worship                         	|   2005   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|     6    	| Grocery store                            	|   2005   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|     7    	| Other store/Mall                         	|   2005   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|     8    	| School                                   	|   2005   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|     9    	| Outdoors away from home                  	|   2005   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|    10    	| Library                                  	|   2005   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|    11    	| Other place                              	|   2005   	| Walking (code = 14) and Cycling (code = 17) to this location    	|
|    1     	| Respondent's home                        	|   1998   	| Walking (code = 7) and Cycling (code = 9) to this location      	|
|     2    	| Work place                               	|   1998   	| Walking (code = 7) and Cycling (code = 9) to this location      	|
|     3    	| Someone else's home                      	|   1998   	| Walking (code = 7) and Cycling (code = 9) to this location      	|
|     4    	| Other plourhood                          	|   1998   	| Walking (code = 7) and Cycling (code = 9) to this location      	|
|     1    	| Respondent's home                        	|   1992   	| Walking (code = 7) and Cycling (code = 9) to this location      	|
|     2    	| Work place                               	|   1992   	| Walking (code = 7) and Cycling (code = 9) to this location      	|
|     3    	| Someone else's home                      	|   1992   	| Walking (code = 7) and Cycling (code = 9) to this location      	|
|    4     	| Other place                              	|   1992   	| Walking (code = 7) and Cycling (code = 9) to this location      	|
|     1    	| Respondent's home                        	|   1886   	| Walking (code = 5) to this location                             	|
|     2    	| Work place                               	|   1886   	| Walking (code = 5) to this location                             	|
|     3    	| AT other places                          	|   1886   	| Walking (code = 5) to this location                             	|
|     7    	| other                                    	|   1886   	| Walking (code = 5) to this location                             	|

### What are the bootstrap weights?

Bootstrap weights are only available for 2015 and this variable have been created for the purpose of design-based variance estimation. In general, bootstrap weights are generated by randomly drawing samples from each stratum of primary sampling units, with replacement; each sample drawn is equal in size to the number of units in the data set; and then the weight is assigned to each unit in the selected primary sampling unit, using the same clustering and multi-stage sampling that is used to generate the final (design) weight; the weight is adjusted to reflect the probability of selection into the random sample. Furthermore, observations or sampling units chosen at random receive a positive bootstrap weight, while units not chosen receive a weight of zero [Satin and Shastry, 1993]. This sampling is repeated many times in order to generate a large enough set of bootstrap weights that are consistent; the number of times this process is repeated equals the number of bootstrap samples. The GSS typically uses B=500, to produce 500 bootstrap weights.


gss_e_2015 |> 
  slice_head() |>
  select(WGHT_EPI, starts_with("WEPI")) |>
  pivot_longer(cols = -WGHT_EPI, 
               names_to = "Bootstrap_number",
               values_to = "Bootstrap_weight") |>
  ggplot() +
  geom_histogram(aes(x = Bootstrap_weight)) +
  geom_vline(aes(xintercept = WGHT_EPI))

WE don't plan to use the bootstrap weights. Furthermore, the Episode File includes critical metadata like diary day, total episodes per respondent, and relevant weighting factors (WGHT_EPI for episode-based estimates and WGHT_PER for respondent-based characteristics, the latter added to each respondent's final episode record). This meticulous structure enhances the utility of the Episode File for detailed time-use analysis, facilitating nuanced understandings of individual behaviors within broader societal patterns, thereby elevating the cohesion and coherence of related research studies.



## Reading Source Files

In this notebook I experiment with reading the files and then saving them to an R native format for ease of use.


Read main files of GSS survey (Episode Files) from 1986 to 2015:
```{r}
gss_e_2015 <- read.csv(paste0(here(), "/data-inputs/source-files/Time use_2015/gss-e.csv"))
gss_e_2010 <- read.csv(paste0(here(), "/data-inputs/source-files/Time use_2010/gss-12M0018-E-2010-c-24-tus-ef_F1.csv"))
gss_e_2005 <- read.csv(paste0(here(), "/data-inputs/source-files/Time use_2005/gss-12M0019-E-2005-c-19-e_F1.csv"))
gss_e_1998 <- read.csv(paste0(here(), "/data-inputs/source-files/Time use_1998/gss-12M0012-E-1998-c-12e_F1.csv"))
gss_e_1992 <- read.csv(paste0(here(), "/data-inputs/source-files/Time use_1992/gss-12M0007-E-1992-c-7-ep_F1.csv"))
gss_e_1986 <- read.csv(paste0(here(), "/data-inputs/source-files/Time use_1986/gss-12M0002-E-1986-c-2-ep_F1.csv"))
```


### Walking_2015

The analysis initiates by constructing a data set specifically for walking, which name is walking_2015, utilizing the episode file of the GSS dataset in 2015. The primary step involves generating a table delineating the origins and destinations associated with walking activities in 2015. To achieve this, the episode file is carefully examined to identify instances where the activity location, corresponding to walking, is denoted by code 315. To comprehensively understand the spatial dynamics, not only the identified walking instances are considered, but also the preceding and succeeding entries are incorporated. These adjacent entries are instrumental in ascertaining the origins and destinations for each respondent's walking activity, thereby offering a nuanced perspective on walking patterns within the data set.

```{r creating dataset for walking 2015, include=FALSE, cache=FALSE}

# walking 2015
# Creating data of origins and destinations of walking trip 2015
inds <- which(gss_e_2015$LOCATION == 315)
rows <- lapply(inds, function(x) (x-1):(x+1))
```

Second, this analysis phase is dedicated to establishing a focused data set about walking activities derived from the 2015 data collection. The process involves a selection of relevant columns from the data table—specifically, those representing crucial variables such as PUMFID (Record identification), WGHT_EPI (Episode weight), TUI_01 (Activity code of the episode), STARTIME (Start time of the episode), ENDTIME (End time of the episode), DURATION (Duration of the episode in minutes), and LOCATION (Location of the episode). Following the extraction of these variables, the analytical procedure progresses to the innovative construction of 'origins' and 'destinations' columns. These are meticulously formulated based on the data of location immediately preceding and succeeding each walking episode for every participant. 

```{r}
walking_2015 <- gss_e_2015 |>
  dplyr::slice(unlist(rows)) |>
  dplyr::select(PUMFID, WGHT_EPI,DDAY,TUI_01:LOCATION) |> 
  #dplyr::slice_head(n = 15) |>
  group_by(PUMFID) |>
  mutate(origin = lag(LOCATION),
         destination = lead(LOCATION)) |>
  #  group_by(PUMFID) %>% 
  filter(LOCATION == 315) |> 
  ungroup()
```


The 'origin' column was filtered in the subsequent analysis phase. Utilizing the code presented below, we developed a methodology to assign labels to various origins, thereby categorizing them into distinct groups for further examination.

```{r}
walking_2015 <- walking_2015 |>
  filter(origin == 300 | 
           origin == 301 | 
           origin == 303 | 
           origin == 302 | 
           origin == 304 |
           origin == 305 | 
           origin == 306 | 
           origin == 307 |
           origin == 308 |
           origin == 309 | 
           origin == 310 |
           origin == 311) |>
  mutate(orig_label =
           case_when(origin == 300 ~ "Home", 
                     origin == 301 ~ "Work or school",
                     origin == 303 ~ "Other's home",
                     origin == 302 ~ "Business",
                     origin == 304 ~ "In the neighbourhood",
                     origin == 305 ~ "Outdoors",
                     origin == 306 ~ "Grocery store, other stores or mall",
                     origin == 308 ~ "Sports centre, field or arena",
                     origin == 307 ~ "Library, museum or theatre",
                     origin == 309 ~ "Restaurant, bar or club",
                     origin == 310 ~ "Place of worship",
                     origin == 311 ~ "Medical, dental or other health clinic"),
         orig_label = factor(orig_label))
```

This step focuses on finding and filtering the destinations of interest in the dataset. After that, a new column will be added to comprehensively list a label for every destination's code.

```{r}
# change destination and origins to text column
walking_2015 <- walking_2015 |>  
  # Choose destinations of interest
  filter(destination == 300 | 
           destination == 301 | 
           destination == 303 |
           destination == 304 |
           destination == 302 | 
           destination == 305 |
           destination == 306 | 
           destination == 307 |
           destination == 308 |
           destination == 309 | 
           destination == 310 |
           destination == 311)  |>
  # Label the destinations
  mutate(dest_label =
           case_when(destination == 300 ~ "Home", 
                     destination == 301 ~ "Work or school",
                     destination == 303 ~ "Other's home",
                     destination == 304 ~ "In the neighbourhood",
                     destination == 302 ~ "Business",
                     destination == 305 ~ "Outdoors",
                     destination == 306 ~ "Grocery store, other stores or mall",
                     destination == 307 ~ "Library, museum or theatre",
                     destination == 308 ~ "Sports centre, field or arena",
                     destination == 309 ~ "Restaurant, bar or club",
                     destination == 310 ~ "Place of worship",
                     destination == 311 ~ "Medical, dental or other health clinic"),
         dest_label = factor(dest_label))
```

In this section, two additional columns ('year' and 'mode') will be integrated into the walking_2015 dataset. This process makes the dataset more compatible and simplifies comparing for various years. Furthermore, the column named TUI_01 will be renamed to ACTCODE to ensure consistency with the naming conventions used in other years.

```{r}
walking_2015 <- walking_2015 |>
  dplyr::select(PUMFID:ENDTIME, DURATION:dest_label) |>
  mutate(YEAR = 2015,
         MODE = "Walking") |>
  dplyr::rename(ACTCODE = TUI_01)
```


Sanity check!
```{r}
walking_2015 |> 
  group_by(orig_label, 
           dest_label) |>
  count() |>
  pivot_wider(names_from = "dest_label", values_from = "n")
```

The most common destination for a walking trip that starts at home are `Home` and `Work or school`. Notice, though, that quite a few trips start _and_ end at Home. What are those supposed to be?

Check those home-to-home trips:
```{r}
walking_2015 |>
  filter(orig_label == "Home" & dest_label == "Home")
```

See PUMFID == 10041 and check the walking episode:
```{r}
gss_e_2015 |>
  filter(PUMFID == 10041) |>
  slice(unique(c(which(LOCATION == 315) - 1, 
                 which(LOCATION == 315),
                 which(LOCATION == 315) + 1))) |>
  dplyr::select(PUMFID:LOCATION)
```

The person was at home doing 27 (personal care), then went for walk that lasted 15 minutes, came back home and spent 180 doing 9 (looking for work). So, this was a recreational/leisure trip!

Note: TUI_01 is an activity code of the episode (What were you doing at minute).The list of main activity codes (001-095) can be found in an appendix of the User Guide. According to this list, 27 is "personal care", 7 is "Transport to or from activity" and 9 is "Looking for work".

QUESTION: Should we include recreational trips in our analysis? If not, then we need to filter out all home-to-home trips.


Save data for later use:
```{r}
save(walking_2015,
     file = paste0(here(), "/data/walking_2015.Rda"))
```


### Cycling 2015

This section delineates how to construct a dataset for cycling trips using the 2015 data repository, which is named cycling_2015. The objective is to identify and catalog the origins and destinations associated with cycling trips, thereby facilitating subsequent analysis. To construct a data table for cycling, we initiate the following steps:

1. Identification of Cycling Episodes:
We analyze the episode file to locate all activities with activity code 318, corresponding to cycling activities. This identification serves as the primary criterion for selecting relevant data points.

2. Inclusion of Adjacent Locations:
We extend our selection for each identified cycling episode to encompass the immediately preceding and succeeding entries. This approach allows us to ascertain the locations immediately before and after cycling, which are subsequently annotated as the origin and destination, respectively, for each identified cycling episode.

3. Data Tabulation:
The extracted information is systematically tabulated, including the cycling activity and its corresponding origin and destination. This table will be a foundational resource for in-depth analysis of cycling patterns within the dataset.


```{r creating dataset for cycling 2015, include=FALSE, cache=FALSE}
# Creating data of origins and destinations of cycling trip 2015
inds <- which(gss_e_2015$LOCATION == 318)
rows <- lapply(inds, function(x) (x-1):(x+1))
```

Following identifying relevant cycling episodes, the subsequent step involves carefully selecting the required variables for the analysis. This stage is integral to refining the dataset to include only essential information directly contributing to our understanding of cycling patterns. The variables chosen in our dataset include:
PUMFID: Serves as the unique record identifier.
WGHT_EPI: This represents the weight of each episode, which is critical for ensuring representativeness in the analysis.
TUI_01: The episode's activity code allows for the categorization of the data based on the activity type.
STARTIME and ENDTIME: These variables provide each episode's start and end times, which are essential for temporal analysis.
DURATION: Indicates the total time spent in the activity, measured in minutes.
LOCATION: Denotes the geographical point of the episode, which is pivotal for spatial analysis.

```{r}
cycling_2015 <- gss_e_2015[unlist(rows),] |> 
  dplyr::select(PUMFID, WGHT_EPI, TUI_01:LOCATION) |>
  mutate(origin = lag(LOCATION, order_by = PUMFID)) |> 
  mutate(destination = lead(LOCATION, order_by = PUMFID)) |>
  group_by(PUMFID) |>
  filter(LOCATION == 318)
```

Once the dataset has been structured with designated origins and destinations for each cycling individual, the next critical phase involves creating a column that describes each origin's code. For instance, if an origin code is '300', the descriptive column would show it as "Home". 

```{r}
cycling_2015 <- cycling_2015 |>
  filter(origin == 300 | 
           origin == 301 | 
           origin == 303 | 
           origin == 302 | 
           origin == 304 |
           origin == 305 | 
           origin == 306 | 
           origin == 307 |
           origin == 308 |
           origin == 309 | 
           origin == 310 |
           origin == 311) |>
  mutate(orig_label =
           case_when(origin == 300 ~ "Home", 
                     origin == 301 ~ "Work or school",
                     origin == 303 ~ "Other's home",
                     origin == 302 ~ "Business",
                     origin == 304 ~ "In the neighbourhood",
                     origin == 305 ~ "Outdoors",
                     origin == 306 ~ "Grocery store, other stores or mall",
                     origin == 308 ~ "Sports centre, field or arena",
                     origin == 307 ~ "Library, museum or theatre",
                     origin == 309 ~ "Restaurant, bar or club",
                     origin == 310 ~ "Place of worship",
                     origin == 311 ~ "Medical, dental or other health clinic"),
         orig_label = factor(orig_label))
```

Similarly to the previous step, the description column will also be created for destinations.
```{r}
# change destination and origins to text column
cycling_2015 <- cycling_2015 |>  
  # Choose destinations of interest
  filter(destination == 300 | 
           destination == 301 | 
           destination == 303 |
           destination == 304 |
           destination == 302 | 
           destination == 305 |
           destination == 306 | 
           destination == 307 |
           destination == 308 |
           destination == 309 | 
           destination == 310 |
           destination == 311)  |>
  # Label the destinations
  mutate(dest_label =
           case_when(destination == 300 ~ "Home", 
                     destination == 301 ~ "Work or school",
                     destination == 303 ~ "Other's home",
                     destination == 304 ~ "In the neighbourhood",
                     destination == 302 ~ "Business",
                     destination == 305 ~ "Outdoors",
                     destination == 306 ~ "Grocery store, other stores or mall",
                     destination == 307 ~ "Library, museum or theatre",
                     destination == 308 ~ "Sports centre, field or arena",
                     destination == 309 ~ "Restaurant, bar or club",
                     destination == 310 ~ "Place of worship",
                     destination == 311 ~ "Medical, dental or other health clinic"),
         dest_label = factor(dest_label))
```


In this section, two additional columns (`year` and `mode`) will be integrated into the cycling_2015 dataset. This process makes the dataset more compatible and simplifies comparing for various years. Furthermore, the column named TUI_01 will be renamed to ACTCODE to ensure consistency with the naming conventions used in other years.

```{r}
cycling_2015 <- cycling_2015 |>
  dplyr::select(PUMFID:ENDTIME, DURATION:dest_label) |>
  mutate(YEAR = 2015,
         MODE = "cycling") |>
  dplyr::rename(ACTCODE = TUI_01)
```

Sanity check!
```{r}
cycling_2015 |> 
  group_by(orig_label, 
           dest_label) |>
  count() |>
  pivot_wider(names_from = "dest_label", values_from = "n")
```

The most common destination for a cycling trip that starts at home is `Work or school`. Notice, though that there are quite a few trips that start _and_ end at Home. What are those supposed to be?

Check those home-to-home trips:
```{r}
cycling_2015 |>
  filter(orig_label == "Home" & dest_label == "Home")
```


See PUMFID == 16591 and check the cycling episode:
```{r}
gss_e_2015 |>
  filter(PUMFID == 16591) |>
  slice(unique(c(reduce(map(which(LOCATION == 318), ~ c(.x - 1, .x, .x + 1)), c)))) |>
   dplyr::select(PUMFID:LOCATION)
```

Note: TUI_01 is an activity code of the episode (What were you doing in minutes?).The list of main activity codes (001-095) can be found in an appendix of the User Guide.

The individual was at home engaged in personal care activities (TUI_01=2) before cycling for approximately 10 minutes to a grocery store. After spending 30 minutes at the store, they cycled back home. Upon returning, the person prepared a meal and performed house cleaning for approximately 85 minutes. Subsequently, the individual embarked on another bicycle trip to the store, which took 10 minutes, and thereafter returned home.
QUESTION: Should we include recreational trips in our analysis? If not, then we need to filter out all home-to-home trips.


Save data for later use:
```{r}
save(cycling_2015,
    file = paste0(here(), "/data/cycling_2015.Rda"))
```



## Walking 2010


The analysis initiates by constructing a data set specifically for walking, which name is walking_2010, utilizing the episode file of the GSS dataset in 2010. The primary step involves generating a table delineating the origins and destinations associated with walking activities in 2010. To achieve this, the episode file is carefully examined to identify instances where the activity location, corresponding to walking, is denoted by code 14. To comprehensively understand the spatial dynamics, not only the identified walking instances are considered, but also the preceding and succeeding entries are incorporated. These adjacent entries are instrumental in ascertaining the origins and destinations for each respondent's walking activity, thereby offering a nuanced perspective on walking patterns within the data set.

```{r creating dataset for walking 2010, include=FALSE, cache=FALSE}

# **walking 2010**
# Creating data of origins and destinations of walking trip 2010
inds <- which(gss_e_2010$PLACE == 14)
rows <- lapply(inds, function(x) (x-1):(x+1))
```

Second, this analysis phase is dedicated to establishing a focused data set about walking activities derived from the 2010 data collection. The process involves a selection of relevant columns from the data table—specifically, those representing crucial variables such as RECID (Record identification), WGHT_EPI (Episode weight), ACTCODE (Activity code of the episode), STARTIME (Start time of the episode), ENDTIME (End time of the episode), DURATION (Duration of the episode in minutes), and PLACE (Location of the episode). Following the extraction of these variables, the analytical procedure progresses to the innovative construction of 'origins' and 'destinations' columns. These are meticulously formulated based on the data of location immediately preceding and succeeding each walking episode for every participant.

```{r}
walking_2010 <- gss_e_2010[unlist(rows),] |> 
  dplyr::select(RECID,WGHT_EPI, ACTCODE:ENDTIME,DURATION,PLACE) |>
  mutate(origin = lag(PLACE, order_by = RECID)) |> 
  mutate(destination = lead(PLACE, order_by = RECID)) |>
  group_by(RECID) |>
  filter(PLACE == 14)
```

The 'origin' column was filtered in the subsequent analysis phase. Utilizing the code presented below, we developed a methodology to assign labels to various origins, thereby categorizing them into distinct groups for further examination.

```{r}
walking_2010 <- walking_2010 |>
  filter(origin == 1 | 
           origin == 2 | 
           origin == 3 | 
           origin == 4 | 
           origin == 5 |
           origin == 6 | 
           origin == 7 | 
           origin == 8 |
           origin == 9 |
           origin == 10 ) |>
  mutate(orig_label =
           case_when(origin == 1 ~ "Home", 
                     origin == 2 ~ "Work or school",
                     origin == 3 ~ "Other's home",
                     origin == 9 ~ "Outdoors",
                     origin == 6 ~ "Grocery store, other stores or mall",
                     origin == 10 ~ "Library, museum or theatre",
                     origin == 4 ~ "Restaurant, bar or club",
                     origin == 5 ~ "Place of worship",
                     origin == 7 ~ "Grocery store, other stores or mall",                     
                     origin == 8 ~ "Work or school"),
         orig_label = factor(orig_label))
```

This step focuses on finding and filtering the destinations of interest in the dataset. After that, a new column will be added to comprehensively list a label for every destination's code.
```{r}
walking_2010 <- walking_2010 |>
  filter(destination == 1 | 
           destination == 2 | 
           destination == 3 | 
           destination == 4 | 
           destination == 5 |
           destination == 6 | 
           destination == 7 | 
           destination == 8 |
           destination == 9 |
           destination == 10 ) |>
  mutate(dest_label =
           case_when(destination == 1 ~ "Home", 
                     destination == 2 ~ "Work or school",
                     destination == 3 ~ "Other's home",
                     destination == 9 ~ "Outdoors",
                     destination == 6 ~ "Grocery store, other stores or mall",
                     destination == 10 ~ "Library, museum or theatre",
                     destination == 4 ~ "Restaurant, bar or club",
                     destination == 5 ~ "Place of worship",
                     destination == 7 ~ "Grocery store, other stores or mall",                     
                     destination == 8 ~ "Work or school"),
         dest_label = factor(dest_label))
```

In this section, two additional columns ('year' and 'mode') will be integrated into the walking_2010 dataset. This process makes the dataset more compatible and simplifies comparing for various years. Furthermore,  columns including `RECID` and `PLACE`  were changed to `PUMFID` and `LOCATION.`  Indeed, the initial names were renamed to align with the names of the variables in 2015.

```{r}
walking_2010 <- walking_2010 |>
  dplyr::select(RECID, WGHT_EPI,ACTCODE, STARTIME:dest_label) |>
  mutate(YEAR = 2010,
         MODE = "Walking")
walking_2010 <- walking_2010 %>% dplyr::rename(
    PUMFID = RECID,
    LOCATION = PLACE)
```


Sanity check!
```{r}
walking_2010 |> 
  group_by(orig_label, 
           dest_label) |>
  count() |>
  pivot_wider(names_from = "dest_label", values_from = "n")
```

The most common destination for a walking trip that starts at home are `Home` and `Work or school`. Notice, though, that quite a few trips start _and_ end at Home. What are those supposed to be? Check those home-to-home trips:

```{r}
walking_2010 |>
  filter(orig_label == "Home" & dest_label == "Home")
```
See RECID == 3 and check the walking episode:

```{r}

gss_e_2010 %>%
  filter(RECID == 3) %>%
  slice(unique(c(reduce(map(which(PLACE == 14), ~ c(.x - 1, .x, .x + 1)), c)))) %>%
  dplyr::select(RECID:PLACE)

```


The individual spent their time at home engaging in meal preparation (ACTCODE=430) for a duration of 15 minutes, followed by a walk lasting approximately 20 minutes to reach a grocery store. After spending 15 minutes there, the person walked an additional 10 minutes to another grocery store, where they stayed for 10 minutes before returning home in 20 minutes. Once home, the individual engaged in socialization for approximately 10 minutes (ACTCODE=751) before taking a 10-minute walk to another location. At this new location, the person undertook activities related to washing and dressing (ACTCODE=400) for around 10 minutes, then went for a 10-minute walk, returning home after that. Subsequently, they dedicated 10 minutes to meal preparation (ACTCODE=101), followed by a 10-minute session of food (or meal) cleanup (ACTCODE=110). The individual then took a 15-minute walk, returned home, and spent 5 minutes on household management tasks, which included organizing and planning activities.

Note: ACTCODE is an activity code of the episode (What were you doing in minute).The list of main activity codes  can be found in an appendix of the User Guide.
QUESTION: Should we include recreational trips in our analysis? If not, then we need to filter out all home-to-home trips.



Save data for later use:
```{r}
save(walking_2010,
    file = paste0(here(), "/data/walking_2010.Rda"))
```


### Cycling 2010


This section delineates how to construct a dataset for cycling trips using the 2010 data repository, which is named cycling_2010. The objective is to identify and catalog the origins and destinations associated with cycling trips, thereby facilitating subsequent analysis. To construct a data table for cycling, we initiate the following steps:

1. Identification of Cycling Episodes:
We analyze the episode file to locate all activities with activity code 17, corresponding to cycling activities. This identification serves as the primary criterion for selecting relevant data points.

2. Inclusion of Adjacent Locations:
We extend our selection for each identified cycling episode to encompass the immediately preceding and succeeding entries. This approach allows us to ascertain the locations immediately before and after cycling, which are subsequently annotated as the origin and destination, respectively, for each identified cycling episode.

3. Data Tabulation:
The extracted information is systematically tabulated, including the cycling activity and its corresponding origin and destination. This table will be a foundational resource for in-depth analysis of cycling patterns within the dataset.


```{r creating dataset for cycling 2010, include=FALSE, cache=FALSE}

# **cycling 2010**
# Creating data of origins and destinations of cycling trip 2010
inds <- which(gss_e_2010$PLACE == 17)
rows <- lapply(inds, function(x) (x-1):(x+1))
```

Following identifying relevant cycling episodes, the subsequent step involves carefully selecting the required variables for the analysis. This stage is integral to refining the dataset to include only essential information directly contributing to our understanding of cycling patterns. The variables chosen in our dataset include:

RECID: Serves as the unique record identifier.
WGHT_EPI: This represents the weight of each episode, which is critical for ensuring representativeness in the analysis.
ACTCODE: The episode's activity code allows for the categorization of the data based on the activity type.
STARTIME and ENDTIME: These variables provide each episode's start and end times, which are essential for temporal analysis.
DURATION: Indicates the total time spent in the activity, measured in minutes.
LOCATION: Denotes the geographical point of the episode, which is pivotal for spatial analysis.

```{r}
cycling_2010 <- gss_e_2010[unlist(rows),] |> 
  dplyr::select(RECID:PLACE) |>
  mutate(origin = lag(PLACE, order_by = RECID)) |> 
  mutate(destination = lead(PLACE, order_by = RECID)) |>
  group_by(RECID) |>
  filter(PLACE == 17)
```


Once the dataset has been structured with designated origins and destinations for each cycling individual, the next critical phase involves creating a column that describes each origin's code. For instance, if an origin code is '1', the descriptive column would show it as "Home".
```{r}
cycling_2010 <- cycling_2010 |>
  filter(origin == 1 | 
           origin == 2 | 
           origin == 3 | 
           origin == 4 | 
           origin == 5 |
           origin == 6 | 
           origin == 7 | 
           origin == 8 |
           origin == 9 |
           origin == 10 ) |>
  mutate(orig_label =
           case_when(origin == 1 ~ "Home", 
                     origin == 2 ~ "Work or school",
                     origin == 3 ~ "Other's home",
                     origin == 9 ~ "Outdoors",
                     origin == 6 ~ "Grocery store, other stores or mall",
                     origin == 10 ~ "Library, museum or theatre",
                     origin == 4 ~ "Restaurant, bar or club",
                     origin == 5 ~ "Place of worship",
                     origin == 7 ~ "Grocery store, other stores or mall",                     
                     origin == 8 ~ "Work or school"),
         orig_label = factor(orig_label))
```

Similarly to the previous step, the description column will also be created for destinations.
```{r}
cycling_2010 <- cycling_2010 |>
  filter(destination == 1 | 
           destination == 2 | 
           destination == 3 | 
           destination == 4 | 
           destination == 5 |
           destination == 6 | 
           destination == 7 | 
           destination == 8 |
           destination == 9 |
           destination == 10 ) |>
  mutate(dest_label =
           case_when(destination == 1 ~ "Home", 
                     destination == 2 ~ "Work or school",
                     destination == 3 ~ "Other's home",
                     destination == 9 ~ "Outdoors",
                     destination == 6 ~ "Grocery store, other stores or mall",
                     destination == 10 ~ "Library, museum or theatre",
                     destination == 4 ~ "Restaurant, bar or club",
                     destination == 5 ~ "Place of worship",
                     destination == 7 ~ "Grocery store, other stores or mall",                     
                     destination == 8 ~ "Work or school"),
         dest_label = factor(dest_label))
```

In this section, two additional columns (`year` and `mode`) will be integrated into the cycling_2010 dataset. This process makes the dataset more compatible and simplifies comparing for various years. Furthermore, columns including `RECID` and `PLACE`  were changed to `PUMFID` and `LOCATION.`  Indeed, the initial names were renamed to align with the names of the variables in 2015.
```{r}
cycling_2010 <- cycling_2010 |>
  dplyr::select(RECID, WGHT_EPI,ACTCODE:ENDTIME, DURATION:dest_label) |>
  mutate(YEAR = 2010,
         MODE = "cycling")
cycling_2010 <- cycling_2010 %>% dplyr::rename(
    PUMFID = RECID,
    LOCATION = PLACE)
```


Sanity check!
```{r}
cycling_2010 |> 
  group_by(orig_label, 
           dest_label) |>
  count() |>
  pivot_wider(names_from = "dest_label", values_from = "n")
```

The most common destination for a cycling trip that starts at home is `Work or school`. Notice, though that there are some trips that start _and_ end at Home. What are those supposed to be?

Check those home-to-home trips:

```{r}
cycling_2010 |>
  filter(orig_label == "Home" & dest_label == "Home")
```


See RECID == 6301 and check the walking episode:
```{r}
gss_e_2010 |>
  filter(RECID == 6301) |>
    slice(unique(c(reduce(map(which(PLACE == 17), ~ c(.x - 1, .x, .x + 1)), c)))) |>
   dplyr::select(RECID:PLACE)
```

The individual engaged in watching television at their residence for approximately 160 minutes before cycling for about 15 minutes. Upon returning home, they socialized for roughly 165 minutes. Following this period of socialization at a private residence, the person embarked on another cycling session for 15 minutes, after which they returned home once more. Subsequently, the individual carried out various household chores for about 10 minutes.


Save data for later use:
```{r}
save(cycling_2010,
    file = paste0(here(), "/data/cycling_2010.Rda"))
```



### Walking 2005


The analysis begins by constructing a data set specifically for walking, which name is walking_2005, utilizing the episode file of the GSS dataset in 2005. The primary step involves generating a table delineating the origins and destinations associated with walking activities in 2005. To achieve this, the episode file is carefully examined to identify instances where the activity location, corresponding to walking, is denoted by code 14. To comprehensively understand the spatial dynamics, not only the identified walking instances are considered, but also the preceding and succeeding entries are incorporated. These adjacent entries are instrumental in ascertaining the origins and destinations for each respondent's walking activity, thereby offering a nuanced perspective on walking patterns within the data set.

```{r creating dataset for walking 2005, include=FALSE, cache=FALSE}

# **walking 2005**
# Creating data of origins and destinations of walking trip 2005
inds = which(gss_e_2005$PLACE == 14)
rows <- lapply(inds, function(x) (x-1):(x+1))
```

Second, this analysis phase is dedicated to establishing a focused data set about walking activities derived from the 2005 data collection. The process involves a selection of relevant columns from the data table—specifically, those representing crucial variables such as RECID (Record identification), WGHT_EPI (Episode weight), ACTCODE (Activity code of the episode), STARTIME (Start time of the episode), ENDTIME (End time of the episode), DURATION (Duration of the episode in minutes), and PLACE (Location of the episode). Following the extraction of these variables, the analytical procedure progresses to the innovative construction of 'origins' and 'destinations' columns. These are meticulously formulated based on the data of location immediately preceding and succeeding each walking episode for every participant.

```{r}
walking_2005 <- gss_e_2005 [unlist(rows),] |>
  dplyr::select(RECID:PLACE) |> 
  mutate(origin = lag(PLACE, order_by = RECID)) |>
  mutate(destination = lead(PLACE, order_by = RECID)) |> 
  group_by(RECID) |> 
  filter(PLACE == 14) 
```


The 'origin' column was filtered in the subsequent analysis phase. Utilizing the code presented below, we developed a methodology to assign labels to various origins, thereby categorizing them into distinct groups for further examination.


```{r}
walking_2005 <- walking_2005 |>
  filter(origin == 1 | 
           origin == 2 | 
           origin == 3 | 
           origin == 4 | 
           origin == 5 |
           origin == 6 | 
           origin == 7 | 
           origin == 8 |
           origin == 9 |
           origin == 10 ) |>
  mutate(orig_label =
           case_when(origin == 1 ~ "Home", 
                     origin == 2 ~ "Work or school",
                     origin == 3 ~ "Other's home",
                     origin == 9 ~ "Outdoors",
                     origin == 6 ~ "Grocery store, other stores or mall",
                     origin == 10 ~ "Library, museum or theatre",
                     origin == 4 ~ "Restaurant, bar or club",
                     origin == 5 ~ "Place of worship",
                     origin == 7 ~ "Grocery store, other stores or mall",                     
                     origin == 8 ~ "Work or school"),
         orig_label = factor(orig_label))
```


This step focuses on finding and filtering the destinations of interest in the dataset. After that, a new column will be added to comprehensively list a label for every destination's code.

```{r}
walking_2005 <- walking_2005 |>
  filter(destination == 1 | 
           destination == 2 | 
           destination == 3 | 
           destination == 4 | 
           destination == 5 |
           destination == 6 | 
           destination == 7 | 
           destination == 8 |
           destination == 9 |
           destination == 10 ) |>
  mutate(dest_label =
           case_when(destination == 1 ~ "Home", 
                     destination == 2 ~ "Work or school",
                     destination == 3 ~ "Other's home",
                     destination == 9 ~ "Outdoors",
                     destination == 6 ~ "Grocery store, other stores or mall",
                     destination == 10 ~ "Library, museum or theatre",
                     destination == 4 ~ "Restaurant, bar or club",
                     destination == 5 ~ "Place of worship",
                     destination == 7 ~ "Grocery store, other stores or mall",                     
                     destination == 8 ~ "Work or school"),
         dest_label = factor(dest_label))
```


In this section, two additional columns ('year' and 'mode') will be integrated into the walking_2005 dataset. This process makes the dataset more compatible and simplifies comparing for various years. Furthermore,  columns including `RECID` and `PLACE`  were changed to `PUMFID` and `LOCATION.`  Indeed, the initial names were renamed to align with the names of the variables in 2015.


```{r}
walking_2005 <- walking_2005 |>
  dplyr::select(RECID, WGHT_EPI, ACTCODE:ENDTIME, DURATION:dest_label) |>
  mutate(YEAR = 2005,
         MODE = "Walking")
walking_2005 <- walking_2005 |> dplyr::rename(
    PUMFID = RECID,
    LOCATION = PLACE) 
```


Sanity check!
```{r}
walking_2005 |> 
  group_by(orig_label, 
           dest_label) |>
  count() |>
  pivot_wider(names_from = "dest_label", values_from = "n")
```

The most common destination for a walking trip that starts at home are  `work or school`, `Other's home` and `home`. Notice, though that one of the most trips start _and_ end at Home. What are those supposed to be?

Check those home-to-home trips:

```{r}
walking_2005 |>
  filter(orig_label == "Home" & dest_label == "Home")
```


See RECID == 89 and check the walking episode:
```{r}
gss_e_2005 |>
  filter(RECID == 89) |>
  slice(unique(c(reduce(map(which(PLACE == 14), ~ c(.x - 1, .x, .x + 1)), c)))) |>
  dplyr::select(RECID:PLACE)
```
The individual engaged in personal grooming and dressing activities (ACTCODE=400) before embarking on a brief walk lasting approximately 5 minutes, after which they returned home. Subsequently, the person participated in religious activities at their residence, which included services, prayer, and Bible readings (ACTCODE=640). Following these activities, the individual undertook another walk of around 5 minutes, returning home once more. At home, they engaged in various activities, including socializing with friends and relatives and sleeping. Later, the person walked for approximately 5 minutes to reach a different location and then spent an additional 5 minutes walking to return home.


Note: ACTCODE is an activity code of the episode (What were you doing in  minutes).The list of main activity codes  can be found in an appendix of the User Guide. QUESTION: Should we include recreational trips in our analysis? If not, then we need to filter out all home-to-home trips.

Save data for later use:
```{r}
save(walking_2005,
     file = paste0(here(), "/data/walking_2005.Rda"))
```


# Cycling_2005


This section delineates how to construct a dataset for cycling trips using the 2005 data repository, which is named cycling_2005. The objective is to identify and catalog the origins and destinations associated with cycling trips, thereby facilitating subsequent analysis. To construct a data table for cycling, we initiate the following steps:

1. Identification of Cycling Episodes:
We analyze the episode file to locate all activities with activity code 17, corresponding to cycling activities. This identification serves as the primary criterion for selecting relevant data points.

2. Inclusion of Adjacent Locations:
We extend our selection for each identified cycling episode to encompass the immediately preceding and succeeding entries. This approach allows us to ascertain the locations immediately before and after cycling, which are subsequently annotated as the origin and destination, respectively, for each identified cycling episode.

3. Data Tabulation:
The extracted information is systematically tabulated, including the cycling activity and its corresponding origin and destination. This table will be a foundational resource for in-depth analysis of cycling patterns within the dataset.


```{r creating dataset for cycling 2005, include=FALSE, cache=FALSE}

# **cycling 2005**
# Creating data of origins and destinations of cycling trip 2005
inds <- which(gss_e_2005$PLACE == 17)
rows <- lapply(inds, function(x) (x-1):(x+1))
```

Following identifying relevant cycling episodes, the subsequent step involves carefully selecting the required variables for the analysis. This stage is integral to refining the dataset to include only essential information directly contributing to our understanding of cycling patterns. The variables chosen in our dataset include:

RECID: Serves as the unique record identifier.
WGHT_EPI: This represents the weight of each episode, which is critical for ensuring representativeness in the analysis.
ACTCODE: The episode's activity code allows for the categorization of the data based on the activity type.
STARTIME and ENDTIME: These variables provide each episode's start and end times, which are essential for temporal analysis.
DURATION: Indicates the total time spent in the activity, measured in minutes.
PLACE: Denotes the geographical point of the episode, which is pivotal for spatial analysis.

```{r}
cycling_2005 <- gss_e_2005[unlist(rows),] |> 
  dplyr::select(RECID:PLACE) |>
  mutate(origin = lag(PLACE, order_by = RECID)) |> 
  mutate(destination = lead(PLACE, order_by = RECID)) |>
  group_by(RECID) |>
  filter(PLACE == 17)
```

Once the dataset has been structured with designated origins and destinations for each cycling individual, the next critical phase involves creating a column that describes each origin's code. For instance, if an origin code is '1', the descriptive column would show it as "Home".
```{r}
cycling_2005 <- cycling_2005 |>
  filter(origin == 1 | 
           origin == 2 | 
           origin == 3 | 
           origin == 4 | 
           origin == 5 |
           origin == 6 | 
           origin == 7 | 
           origin == 8 |
           origin == 9 |
           origin == 10 ) |>
  mutate(orig_label =
           case_when(origin == 1 ~ "Home", 
                     origin == 2 ~ "Work or school",
                     origin == 3 ~ "Other's home",
                     origin == 9 ~ "Outdoors",
                     origin == 6 ~ "Grocery store, other stores or mall",
                     origin == 10 ~ "Library, museum or theatre",
                     origin == 4 ~ "Restaurant, bar or club",
                     origin == 5 ~ "Place of worship",
                     origin == 7 ~ "Grocery store, other stores or mall",                     
                     origin == 8 ~ "Work or school"),
         orig_label = factor(orig_label))
```

Similarly to the previous step, the description column will also be created for destinations.
```{r}
cycling_2005 <- cycling_2005 |>
  filter(destination == 1 | 
           destination == 2 | 
           destination == 3 | 
           destination == 4 | 
           destination == 5 |
           destination == 6 | 
           destination == 7 | 
           destination == 8 |
           destination == 9 |
           destination == 10 ) |>
  mutate(dest_label =
           case_when(destination == 1 ~ "Home", 
                     destination == 2 ~ "Work or school",
                     destination == 3 ~ "Other's home",
                     destination == 9 ~ "Outdoors",
                     destination == 6 ~ "Grocery store, other stores or mall",
                     destination == 10 ~ "Library, museum or theatre",
                     destination == 4 ~ "Restaurant, bar or club",
                     destination == 5 ~ "Place of worship",
                     destination == 7 ~ "Grocery store, other stores or mall",                     
                     destination == 8 ~ "Work or school"),
         dest_label = factor(dest_label))
```

In this section, two additional columns (`year` and `mode`) will be integrated into the cycling_2005 dataset. This process makes the dataset more compatible and simplifies comparing for various years. Furthermore,  columns including `RECID` and `PLACE`  were changed to `PUMFID` and `LOCATION.`  Indeed, the initial names were renamed to align with the names of the variables in 2015.
```{r}
cycling_2005 <- cycling_2005 |>
  dplyr::select(RECID, WGHT_EPI, ACTCODE:ENDTIME, DURATION:dest_label) |>
  mutate(YEAR = 2005,
         MODE = "cycling")
cycling_2005 <- cycling_2005 |> dplyr::rename(
    PUMFID = RECID,
    LOCATION = PLACE) 
```


Sanity check!
```{r}
cycling_2005 |> 
  group_by(orig_label, 
           dest_label) |>
  count() |>
  pivot_wider(names_from = "dest_label", values_from = "n")
```

The most common destination for a cycling trip that starts at home is `Work or school`. Notice, though that there are some trips that start _and_ end at Home. What are those supposed to be?

Check those home-to-home trips:
```{r}
cycling_2005 |>
  filter(orig_label == "Home" & dest_label == "Home")
```


See RECID == 1903 and check the cycling episode:
```{r}
gss_e_2005 |>
  filter(RECID == 1903) |>
  slice(unique(c(reduce(map(which(PLACE == 17), ~ c(.x - 1, .x, .x + 1)), c)))) |>  
   dplyr::select(RECID:PLACE)
```

The individual remained at home, where they slept for approximately 420 minutes. Subsequently, they ventured out for a 15-minute cycling session before returning home. Upon their return, they engaged in an activity labeled as ACTCODE=11 for 465 minutes, which denotes working from home as their primary workplace. Following this work period, the person went out for another 15-minute cycling session, then returned home once more and spent 90 minutes watching television.

Save data for later use:
```{r}
save(cycling_2005,
     file = paste0(here(), "/data/cycling_2005.Rda"))
```



# Walking 1998


The analysis initiates by constructing a data set specifically for walking, which name is walking_1998, utilizing the episode file of the GSS dataset in 1998. The primary step involves generating a table delineating the origins and destinations associated with walking activities in 1998. To achieve this, the episode file is carefully examined to identify instances where the activity location, corresponding to walking, is denoted by code 7. To comprehensively understand the spatial dynamics, not only the identified walking instances are considered, but also the preceding and succeeding entries are incorporated. These adjacent entries are instrumental in ascertaining the origins and destinations for each respondent's walking activity, thereby offering a nuanced perspective on walking patterns within the data set.

```{r creating dataset for walking 1998, include=FALSE, cache=FALSE}

# **walking 1998**
# Creating data of origins and destinations of walking trip 1998
inds = which(gss_e_1998$PLACE == 7)
rows <- lapply(inds, function(x) (x-1):(x+1))
```

Second, this analysis phase is dedicated to establishing a focused data set about walking activities derived from the 1998 data collection. The process involves a selection of relevant columns from the data table—specifically, those representing crucial variables such as RECID (Record identification), WGHT_EPI (Episode weight), ACTCODE (Activity code of the episode), STARTIME (Start time of the episode), ENDTIME (End time of the episode), DURATION (Duration of the episode in minutes), and PLACE (Location of the episode). Following the extraction of these variables, the analytical procedure progresses to the innovative construction of 'origins' and 'destinations' columns. These are meticulously formulated based on the data of location immediately preceding and succeeding each walking episode for every participant.

```{r}
walking_1998 <- gss_e_1998 [unlist(rows),] |>
  dplyr::select(RECID:PLACE) |> 
  mutate(origin = lag(PLACE, order_by = RECID)) |>
  mutate(destination = lead(PLACE, order_by = RECID)) |> 
  group_by(RECID) |> 
  filter(PLACE == 7) 
```


The 'origin' column was filtered in the subsequent analysis phase. Utilizing the code presented below, we developed a methodology to assign labels to various origins, thereby categorizing them into distinct groups for further examination.


```{r}
walking_1998 <- walking_1998 |>
  filter(origin == 1 | 
           origin == 2 | 
           origin == 3 ) |>
  mutate(orig_label =
           case_when(origin == 1 ~ "Home", 
                     origin == 2 ~ "Work or school",
                     origin == 3 ~ "Other's home"),
         orig_label = factor(orig_label))
```

This step focuses on finding and filtering the destinations of interest in the dataset. After that, a new column will be added to comprehensively list a label for every destination's code.

```{r}
walking_1998 <- walking_1998 |>
  filter(destination == 1 | 
           destination == 2 | 
           destination == 3 ) |>
  mutate(dest_label =
           case_when(destination == 1 ~ "Home", 
                     destination == 2 ~ "Work or school",
                     destination == 3 ~ "Other's home"),
         dest_label = factor(dest_label))
```


In this section, two additional columns (`year` and `mode`) will be integrated into the walking_1998 dataset. This process makes the dataset more compatible and simplifies comparing for various years. Furthermore,  columns including `RECID`, `WGHTEPI` and `PLACE`  were changed to `PUMFID`, `WGHT_EPI` and `LOCATION`  Indeed, the initial names were renamed to align with the names of the variables in 2015.

```{r}
walking_1998 <- walking_1998 |>
  dplyr::select(RECID, WGHTEPI,ACTCODE: ENDTIME, DURATION:dest_label) |>
  mutate(YEAR = 1998,
         MODE = "Walking")
walking_1998 <- walking_1998|> dplyr::rename(
    PUMFID = RECID,
    WGHT_EPI = WGHTEPI,
    LOCATION = PLACE) 
```


Sanity check!
```{r}
walking_1998 |> 
  group_by(orig_label, 
           dest_label) |>
  count() |>
  pivot_wider(names_from = "dest_label", values_from = "n")
```

The most common destination for a walking trip that starts at home are `other's Home` and `Work or school`. Check those home-to-home trips:
```{r}
walking_1998 |>
  filter(orig_label == "Home" & dest_label == "Home")
```


See RECID == 15 and check the walking episode:
```{r}
gss_e_1998 |>
  filter(RECID == 15) |>
  slice(unique(c(reduce(map(which(PLACE == 7), ~ c(.x - 1, .x, .x + 1)), c)))) |>
  dplyr::select(RECID:PLACE)

```

The person was at home doing 430 (MEALS AT HOME/SNACKS/COFFEE), then went for walking that lasted 45 minutes, came back home and spent 240 min doing 911 (WATCHING TELEVISION (REGULAR SCHEDULED TELEVISION)). So, this was a recreational/leisure trip!

QUESTION: Should we include recreational trips in our analysis? If not, then we need to filter out all home-to-home trips.


Save data for later use:
```{r}
save(walking_1998,
     file = paste0(here(), "/data/walking_1998.Rda"))
```



# Cycling_1998

This section delineates how to construct a dataset for cycling trips using the 1998 data repository, which is named cycling_1998. The objective is to identify and catalog the origins and destinations associated with cycling trips, thereby facilitating subsequent analysis. To construct a data table for cycling, we initiate the following steps:

1. Identification of Cycling Episodes:
We analyze the episode file to locate all activities with activity code 9, corresponding to cycling activities. This identification serves as the primary criterion for selecting relevant data points.

2. Inclusion of Adjacent Locations:
We extend our selection for each identified cycling episode to encompass the immediately preceding and succeeding entries. This approach allows us to ascertain the locations immediately before and after cycling, which are subsequently annotated as the origin and destination, respectively, for each identified cycling episode.

3. Data Tabulation:
The extracted information is systematically tabulated, including the cycling activity and its corresponding origin and destination. This table will be a foundational resource for in-depth analysis of cycling patterns within the dataset.

```{r creating dataset for cycling 1998, include=FALSE, cache=FALSE}
# **cycling 1998**
# Creating data of origins and destinations of cycling trip 1998
inds <- which(gss_e_1998$PLACE == 9)
rows <- lapply(inds, function(x) (x-1):(x+1))
```

Following identifying relevant cycling episodes, the subsequent step involves carefully selecting the required variables for the analysis. This stage is integral to refining the dataset to include only essential information directly contributing to our understanding of cycling patterns. The variables chosen in our dataset include:

RECID: Serves as the unique record identifier.
WGHTEPI: This represents the weight of each episode, which is critical for ensuring representativeness in the analysis.
ACTCODE: The episode's activity code allows for the categorization of the data based on the activity type.
STARTIME and ENDTIME: These variables provide each episode's start and end times, which are essential for temporal analysis.
DURATION: Indicates the total time spent in the activity, measured in minutes.
PLACE: Denotes the geographical point of the episode, which is pivotal for spatial analysis.



```{r}
cycling_1998 <- gss_e_1998[unlist(rows),] |> 
  dplyr::select(RECID:PLACE) |>
  mutate(origin = lag(PLACE, order_by = RECID)) |> 
  mutate(destination = lead(PLACE, order_by = RECID)) |>
  group_by(RECID) |>
  filter(PLACE == 9)
```

Once the dataset has been structured with designated origins and destinations for each cycling individual, the next critical phase involves creating a column that describes each origin's code. For instance, if an origin code is '1', the descriptive column would show it as "Home".

```{r}
cycling_1998 <- cycling_1998 |>
  filter(origin == 1 | 
           origin == 2 | 
           origin == 3 ) |>
  mutate(orig_label =
           case_when(origin == 1 ~ "Home", 
                     origin == 2 ~ "Work or school",
                     origin == 3 ~ "Other's home"),
         orig_label = factor(orig_label))
```

Similarly to the previous step, the description column will also be created for destinations.
```{r}
cycling_1998 <- cycling_1998 |>
  filter(destination == 1 | 
           destination == 2 | 
           destination == 3 ) |>
  mutate(dest_label =
           case_when(destination == 1 ~ "Home", 
                     destination == 2 ~ "Work or school",
                     destination == 3 ~ "Other's home"),
         dest_label = factor(dest_label))
```

In this section, two additional columns (`year` and `mode`) will be integrated into the cycling_1998 dataset. This process makes the dataset more compatible and simplifies comparing for various years. Furthermore,  columns including `RECID`, `WGHTEPI` and `PLACE`  were changed to `PUMFID`,`WGHT_EPI` and `LOCATION`.  Indeed, the initial names were renamed to align with the names of the variables in 2015.
```{r}
cycling_1998 <- cycling_1998 |>
  dplyr::select(RECID, WGHTEPI,ACTCODE: ENDTIME, DURATION:dest_label) |>
  mutate(YEAR = 1998,
         MODE = "cycling")
cycling_1998 <- cycling_1998|> dplyr::rename(
    PUMFID = RECID,
    WGHT_EPI = WGHTEPI,
    LOCATION = PLACE) 
```


Sanity check!
```{r}
cycling_1998 |> 
  group_by(orig_label, 
           dest_label) |>
  count() |>
  pivot_wider(names_from = "dest_label", values_from = "n")
```

The most common destination for a cycling trip that starts at home is `Work or school`. Notice, though that there are some trips that start _and_ end at Home. What are those supposed to be?

Check those home-to-home trips:
```{r}
cycling_1998 |>
  filter(orig_label == "Home" & dest_label == "Home")
```


See RECID == 656 and check the cycling episode:
```{r}
gss_e_1998 |>
  filter(RECID == 656) |>
  slice(unique(c(reduce(map(which(PLACE == 9), ~ c(.x - 1, .x, .x + 1)), c)))) |>  
   dplyr::select(RECID:PLACE)
```
The individual engaged in personal care activities at home before embarking on a cycling excursion for approximately 5 minutes. Upon returning home, they participated in various sports, including football, baseball, hockey, among others. Subsequently, the person undertook another 5-minute cycling session before returning home.

Save data for later use:
```{r}
save(cycling_1998,
     file = paste0(here(), "/data/cycling_1998.Rda"))
```



# Walking_1992


The analysis initiates by constructing a data set specifically for walking, which name is walking_1992, utilizing the episode file of the GSS dataset in 1992. The primary step involves generating a table delineating the origins and destinations associated with walking activities in 1992. To achieve this, the episode file is carefully examined to identify instances where the activity location, corresponding to walking, is denoted by code 7. To comprehensively understand the spatial dynamics, not only the identified walking instances are considered, but also the preceding and succeeding entries are incorporated. These adjacent entries are instrumental in ascertaining the origins and destinations for each respondent's walking activity, thereby offering a nuanced perspective on walking patterns within the data set.

```{r creating dataset for walking 1992, include=FALSE, cache=FALSE}

# **walking 1992**
# Creating data of origins and destinations of walking trip 1992
inds = which(gss_e_1992$PLACE == 7)
rows <- lapply(inds, function(x) (x-1):(x+1))
```

Second, this analysis phase is dedicated to establishing a focused data set about walking activities derived from the 1992 data collection. The process involves a selection of relevant columns from the data table—specifically, those representing crucial variables such as SEQNUM (Record identification), TIMEWGT (Episode weight), ACTCODE (Activity code of the episode), STARTIME (Start time of the episode), ENDTIME (End time of the episode), DURATION (Duration of the episode in minutes), and PLACE (Location of the episode). Following the extraction of these variables, the analytical procedure progresses to the innovative construction of `origins` and `destinations` columns. These are meticulously formulated based on the data of location immediately preceding and succeeding each walking episode for every participant.

```{r}
walking_1992 <- gss_e_1992 [unlist(rows),] |>
  dplyr::select(SEQNUM:PLACE,TIMEWGT) |> 
  mutate(origin = lag(PLACE, order_by = SEQNUM)) |>
  mutate(destination = lead(PLACE, order_by = SEQNUM)) |> 
  group_by(SEQNUM) |> 
  filter(PLACE == 7) 
```

The 'origin' column was filtered in the subsequent analysis phase. Utilizing the code presented below, we developed a methodology to assign labels to various origins, thereby categorizing them into distinct groups for further examination.

```{r}
walking_1992 <- walking_1992 |>
  filter(origin == 1 | 
           origin == 2 | 
           origin == 3) |>
  mutate(orig_label =
           case_when(origin == 1 ~ "Home", 
                     origin == 2 ~ "Work or school",
                     origin == 3 ~ "Other's home"),
         orig_label = factor(orig_label))
```

This step focuses on finding and filtering the destinations of interest in the dataset. After that, a new column will be added to comprehensively list a label for every destination's code.

```{r}
walking_1992 <- walking_1992 |>
  filter(destination == 1 | 
           destination == 2 | 
           destination == 3 ) |>
  mutate(dest_label =
           case_when(destination == 1 ~ "Home", 
                     destination == 2 ~ "Work or school",
                     destination == 3 ~ "Other's home"),
         dest_label = factor(dest_label))
```

In this section, two additional columns (`year` and `mode`) will be integrated into the walking_1992 dataset. This process makes the dataset more compatible and simplifies comparing for various years. Furthermore,  columns including `SEQNUM`, `TIMEWGT`  and `PLACE`  were changed to `PUMFID`, `WGHT_EPI` and `LOCATION.`  Indeed, the initial names were renamed to align with the names of the variables in 2015.
```{r}
walking_1992 <- walking_1992 |>
  dplyr::select(SEQNUM,TIMEWGT,ACTCODE:dest_label) |>
  mutate(YEAR = 1992,
         MODE = "Walking")
walking_1992 <- walking_1992 |> dplyr::rename(
    PUMFID = SEQNUM,
    WGHT_EPI = TIMEWGT,
    LOCATION = PLACE)
```


Sanity check!
```{r}
walking_1992 |> 
  group_by(orig_label, 
           dest_label) |>
  count() |>
  pivot_wider(names_from = "dest_label", values_from = "n")
```

The most common destination for a walking trip that starts at home is `Home`. Notice, though that the most trips start _and_ end at Home. What are those supposed to be?

Check those home-to-home trips:
```{r}
walking_1992 |>
  filter(orig_label == "Home" & dest_label == "Home")
```


See SEQNUM == 218 and check the walking episode:
```{r}
gss_e_1992 |>
  filter(SEQNUM == 218) |>
  slice(unique(c(reduce(map(which(PLACE == 7), ~ c(.x - 1, .x, .x + 1)), c)))) |>
  dplyr::select(SEQNUM:PLACE)

```

The person was at home doing 430 (Meals at Home/Snacks/Coffee), then went for walking that lasted 5 minutes, came back home and spent 35 doing 181 (Household management (Household Administration, e.g.Paying Bills, Menu Planning, etc.). So, this was a recreational/leisure trip!

Note: ACTCODE is an activity code of the episode (What were you doing at [hour:minute]?).The list of main activity codes  can be found in an appendix of the User Guide.

QUESTION: Should we include recreational trips in our analysis? If not, then we need to filter out all home-to-home trips.


Save data for later use:
```{r}
save(walking_1992,
     file = paste0(here(), "/data/walking_1992.Rda"))
```




# Cycling_1992


This section delineates how to construct a dataset for cycling trips using the 1992 data repository, which is named cycling_1992. The objective is to identify and catalog the origins and destinations associated with cycling trips, thereby facilitating subsequent analysis. To construct a data table for cycling, we initiate the following steps:

1. Identification of Cycling Episodes:
We analyze the episode file to locate all activities with activity code 318, corresponding to cycling activities. This identification serves as the primary criterion for selecting relevant data points.

2. Inclusion of Adjacent Locations:
We extend our selection for each identified cycling episode to encompass the immediately preceding and succeeding entries. This approach allows us to ascertain the locations immediately before and after cycling, which are subsequently annotated as the origin and destination, respectively, for each identified cycling episode.

3. Data Tabulation:
The extracted information is systematically tabulated, including the cycling activity and its corresponding origin and destination. This table will be a foundational resource for in-depth analysis of cycling patterns within the dataset.


```{r creating dataset for cycling 1992, include=FALSE, cache=FALSE}
# **cycling 1992**
# Creating data of origins and destinations of cycling trip 1992
inds <- which(gss_e_1992$PLACE == 9)
rows <- lapply(inds, function(x) (x-1):(x+1))
```

Following identifying relevant cycling episodes, the subsequent step involves carefully selecting the required variables for the analysis. This stage is integral to refining the dataset to include only essential information directly contributing to our understanding of cycling patterns. The variables chosen in our dataset include:

SEQNUM: Serves as the unique record identifier.
TIMEWGT: This represents the weight of each episode, which is critical for ensuring representativeness in the analysis.
ACTCODE: The episode's activity code allows for the categorization of the data based on the activity type.
STARTIME and ENDTIME: These variables provide each episode's start and end times, which are essential for temporal analysis.
DURATION: Indicates the total time spent in the activity, measured in minutes.
PLACE: Denotes the geographical point of the episode, which is pivotal for spatial analysis.


```{r}
cycling_1992 <- gss_e_1992[unlist(rows),] |> 
  dplyr::select(SEQNUM:PLACE, TIMEWGT) |>
  mutate(origin = lag(PLACE, order_by = SEQNUM)) |> 
  mutate(destination = lead(PLACE, order_by = SEQNUM)) |>
  group_by(SEQNUM) |>
  filter(PLACE == 9)
```

Once the dataset has been structured with designated origins and destinations for each cycling individual, the next critical phase involves creating a column that describes each origin's code. For instance, if an origin code is '1', the descriptive column would show it as "Home".

```{r}
cycling_1992 <- cycling_1992 |>
  filter(origin == 1 | 
           origin == 2 | 
           origin == 3 ) |>
  mutate(orig_label =
           case_when(origin == 1 ~ "Home", 
                     origin == 2 ~ "Work or school",
                     origin == 3 ~ "Other's home"),
         orig_label = factor(orig_label))
```

Similarly to the previous step, the description column will also be created for destinations.
```{r}
cycling_1992 <- cycling_1992 |>
  filter(destination == 1 | 
           destination == 2 | 
           destination == 3 ) |>
  mutate(dest_label =
           case_when(destination == 1 ~ "Home", 
                     destination == 2 ~ "Work or school",
                     destination == 3 ~ "Other's home"),
         dest_label = factor(dest_label))
```

In this section, two additional columns (`year` and `mode`) will be integrated into the cycling_1992 dataset. This process makes the dataset more compatible and simplifies comparing for various years. Furthermore,  columns including `SEQNUM`, `TIMEWGT` and `PLACE` were changed to `PUMFID`,`WGHT_EPI` and `LOCATION`.  Indeed, the initial names were renamed to align with the names of the variables in 2015.
```{r}
cycling_1992 <- cycling_1992 |>
  dplyr::select(SEQNUM,TIMEWGT,ACTCODE:dest_label) |>
  mutate(YEAR = 1992,
         MODE = "cycling")
cycling_1992 <- cycling_1992 |> dplyr::rename(
    PUMFID = SEQNUM,
    WGHT_EPI = TIMEWGT,
    LOCATION = PLACE)
```


Sanity check!
```{r}
cycling_1992 |> 
  group_by(orig_label, 
           dest_label) |>
  count() |>
  pivot_wider(names_from = "dest_label", values_from = "n")
```

The most common destination for a cycling trip that starts at home is `Work or school`. Notice, though that there are quite a few trips that start _and_ end at Home. What are those supposed to be?

Check those home-to-home trips:
```{r}
cycling_1992 |>
  filter(orig_label == "Home" & dest_label == "Home")
```


See SEQNUM == 3622 and check the cycling episode:
```{r}
gss_e_1992 |>
  filter(SEQNUM == 3622) |>
  slice(unique(c(reduce(map(which(PLACE == 9), ~ c(.x - 1, .x, .x + 1)), c)))) |>   
   dplyr::select(SEQNUM:PLACE)
```


The person was at home doing 950 (Talking, conversation, phone), then went for cycling that lasted 120 minutes, came back home and spent 30 minutes doing 130 (outdoor cleaning (garbage, snow, removal, garage)).So, this was a recreational/leisure trip!

Note: ACTCODE is an activity code of the episode (What were you doing at [hour:minute]?).The list of main activity codes can be found in an appendix of the User Guide.

QUESTION: Should we include recreational trips in our analysis? If not, then we need to filter out all home-to-home trips.

Save data for later use:
```{r}
save(cycling_1992,
     file = paste0(here(), "/data/cycling_1992.Rda"))
```



# Walking 1986

Here a table with origins and destinations for walking in 1986 will be created. First, I'll identify the rows in the episode file where the location of the activity was `5`, which is code for `walking` as well as one row before and after them to identify the locations before and after the walking that will be considered as the origin and destination for each respondent. 

The analysis initiates by constructing a data set specifically for walking, which name is walking_1986, utilizing the episode file of the GSS dataset in 1986. The primary step involves generating a table delineating the origins and destinations associated with walking activities in 1986. To achieve this, the episode file is carefully examined to identify instances where the activity location, corresponding to walking, is denoted by code 5. To comprehensively understand the spatial dynamics, not only the identified walking instances are considered, but also the preceding and succeeding entries are incorporated. These adjacent entries are instrumental in ascertaining the origins and destinations for each respondent's walking activity, thereby offering a nuanced perspective on walking patterns within the data set.

```{r creating dataset for walking 1986, include=FALSE, cache=FALSE}

# **walking 1986**
# Creating data of origins and destinations of walking trip 1986
inds = which(gss_e_1986$PLACE == 5)
rows <- lapply(inds, function(x) (x-1):(x+1))
```


Second, this analysis phase is dedicated to establishing a focused data set about walking activities derived from the 1986  data collection. The process involves a selection of relevant columns from the data table—specifically, those representing crucial variables such as SEQNUM (Record identification), FWGT_MS (Episode weight), ACT_CODE (Activity code of the episode), STARTIME (Start time of the episode), ENDTIME (End time of the episode), DURATION (Duration of the episode in minutes), and PLACE (Location of the episode). Following the extraction of these variables, the analytical procedure progresses to the innovative construction of `origins` and `destinations` columns. These are meticulously formulated based on the data of location immediately preceding and succeeding each walking episode for every participant.

```{r}
walking_1986 <- gss_e_1986 [unlist(rows),] |>
  dplyr::select(SEQNUM:PLACE,FWGT_MS) |> 
  mutate(origin = lag(PLACE, order_by = SEQNUM)) |>
  mutate(destination = lead(PLACE, order_by = SEQNUM)) |> 
  group_by(SEQNUM) |> 
  filter(PLACE == 5) 
```

The 'origin' column was filtered in the subsequent analysis phase. Utilizing the code presented below, we developed a methodology to assign labels to various origins, thereby categorizing them into distinct groups for further examination.

```{r}
walking_1986 <- walking_1986 |>
  filter(origin == 1 | 
           origin == 2 | 
           origin == 3) |>
  mutate(orig_label =
           case_when(origin == 1 ~ "Home", 
                     origin == 2 ~ "Work or school",
                     origin == 3 ~ "Other's home"),
         orig_label = factor(orig_label))
```


This step focuses on finding and filtering the destinations of interest in the dataset. After that, a new column will be added to comprehensively list a label for every destination's code.

```{r}
walking_1986 <- walking_1986 |>
  filter(destination == 1 | 
           destination == 2 | 
           destination == 3 ) |>
  mutate(dest_label =
           case_when(destination == 1 ~ "Home", 
                     destination == 2 ~ "Work or school",
                     destination == 3 ~ "Other's home"),
         dest_label = factor(dest_label))
```

In this section, two additional columns (`year` and `mode`) will be integrated into the walking_1986 dataset. This process makes the dataset more compatible and simplifies comparing for various years. Furthermore,  columns including `SEQNUM`, `FWGT_MS`, `ACT_CODE`, `STRTTIME` and `PLACE`  were changed to `PUMFID`,`WGHT_EPI`, `ACTCODE`, `STARTIME` and `LOCATION`.  Indeed, the initial names were renamed to align with the names of the variables in 2015.

```{r}
walking_1986 <- walking_1986 |>
  dplyr::select(SEQNUM,ACT_CODE:dest_label) |>
  mutate(YEAR = 1986,
         MODE = "Walking")
walking_1986 <- walking_1986 |> dplyr::rename(
    PUMFID = SEQNUM,
    STARTIME= STRTTIME,
    WGHT_EPI = FWGT_MS,
    ACTCODE = ACT_CODE,
    LOCATION = PLACE)
```


Sanity check!
```{r}
walking_1986 |> 
  group_by(orig_label, 
           dest_label) |>
  count() |>
  pivot_wider(names_from = "dest_label", values_from = "n")
```

One of the most common destination for a walking trip that starts at home is `HOME`. Notice, though that the most trips start _and_ end at Home. What are those supposed to be?

Check those home-to-home trips:
```{r}
walking_1986 |>
  filter(orig_label == "Home" & dest_label == "Home")
```

See SEQNUM == 26 and check the walking episode:
```{r}
gss_e_1986 |>
  filter(SEQNUM == 26) |>
  slice(unique(c(reduce(map(which(PLACE == 5), ~ c(.x - 1, .x, .x + 1)), c)))) |>
  dplyr::select(SEQNUM:PLACE)

```

The person was at home doing 24 (play with children), then went for walking that lasted 120 minutes, came back home and spent 30 minutes doing 43 (Household management (Meals at home/snacks/ coffee). So, this was a recreational/leisure trip! QUESTION: Should we include recreational trips in our analysis? If not, then we need to filter out all home-to-home trips.
Save data for later use:
```{r}
save(walking_1986,
     file = paste0(here(), "/data/walking_1986.Rda"))
```


# Cycling 1986

No data are available regarding cycling trips in 1986.










# creating an integrated data frame from 1992 to 2015


```{r}
trip_w_f <- rbind(walking_2015,walking_2010, walking_2005, walking_1998 ,walking_1992,  walking_1986) 
trip_c_f <- rbind(cycling_2015,cycling_2010, cycling_2005, cycling_1998 ,cycling_1992)
trip_f <-  rbind(walking_2015,walking_2010, walking_2005, walking_1998 ,walking_1992,  walking_1986, cycling_2015,cycling_2010, cycling_2005, cycling_1998 ,cycling_1992)
```


Here, creating a figure of impedance function for walking trips during 1986- 2015.
```{r}
ggplot(data = trip_w_f, aes(x = DURATION, y = f)) + 
geom_line(linetype = "solid", color = "blue", size =1.25) +
  facet_grid(. ~ YEAR) +
  scale_x_continuous("Time in minutes") +
  scale_y_continuous("Cumulative Percentage of Trips") +
  labs(title = "Impedance function for walking trip from 1986 - 2015")
#ggsave("IP_W.png", dpi = 600)
```

```{r}
summary(trip_c_f)
print(summary)
```
Here, creating a figure of impedance function for cycling trips during 1986- 2015

```{r}
ggplot(data = trip_c_f, aes(x = DURATION, y = f)) + 
geom_line(linetype = "solid", na.rm=TRUE, color = "red", size =1.25) +
  facet_grid(. ~ YEAR) +
  scale_x_continuous("Time in minutes") +
  scale_y_continuous("Cumulative Percentage of Trips") +
  labs(title = "Impedance function for cycling trip from 1986 - 2015")
#ggsave("IP_C.png", dpi = 600)
```

creating a figure of impedance function of walking and cycling to different destinations in 2015 

```{r}
trip__f_2015 <- rbind(walking_2015,cycling_2015)
```

```{r}
ggplot(data = trip__f_2015, aes(x = DURATION, y = f, color = MODE)) + 
geom_line() +
  facet_wrap(facets = vars(dest_label)) +
  scale_x_continuous("Time in minutes") +
  scale_y_continuous("Cumulative Percentage of Trips") +
  labs(title = "Impedance function to different destinations in 2015")
#ggsave("IP_2015.png", dpi = 600)
```

creating a figure of impedance function of walking and cycling to different destinations in 2010
```{r}
trip__f_2010 <- rbind(walking_2010,cycling_2010)
```

```{r}
ggplot(data = trip__f_2010, aes(x = DURATION, y = f, color = MODE)) + 
geom_line() +
  facet_wrap(facets = vars(dest_label)) +
  scale_x_continuous("Time in minutes") +
  scale_y_continuous("Cumulative Percentage of Trips") +
  labs(title = "Impedance function to different destinations in 2010")
#ggsave("IP_2010.png", dpi = 600)
```

creating a figure of impedance function of walking and cycling to different destinations in 2005

```{r}
trip__f_2005 <- rbind(walking_2005,cycling_2005)
```

```{r}
ggplot(data = trip__f_2005, aes(x = DURATION, y = f, color = MODE)) + 
geom_line() +
  facet_wrap(facets = vars(dest_label)) +
  scale_x_continuous("Time in minutes") +
  scale_y_continuous("Cumulative Percentage of Trips") +
  labs(title = "Impedance function to different destinations in 2005")
#ggsave("IP_2005.png", dpi = 600)
```

creating a figure of impedance function of walking and cycling to different destinations in 1998

```{r}
trip__f_1998 <- rbind(walking_1998,cycling_1998)
```

```{r}
ggplot(data = trip__f_1998, aes(x = DURATION, y = f, color = MODE)) + 
geom_line() +
  facet_wrap(facets = vars(dest_label)) +
  scale_x_continuous("Time in minutes") +
  scale_y_continuous("Cumulative Percentage of Trips") +
  labs(title = "Impedance function to different destinations in 1998")
#ggsave("IP_1998.png", dpi = 600)
```

creating a figure of impedance function of walking and cycling to different destinations in 1992
```{r}
trip__f_1992 <- rbind(walking_1992,cycling_1992)
```

```{r}
ggplot(data = trip__f_1992, aes(x = DURATION, y = f, color = MODE)) + 
geom_line() +
  facet_wrap(facets = vars(dest_label)) +
  scale_x_continuous("Time in minutes") +
  scale_y_continuous("Cumulative Percentage of Trips") +
  labs(title = "Impedance function to different destinations in 1992")
#ggsave("IP_1992.png", dpi = 600)
```


creating a figure of impedance function of walking and cycling to different destinations in 1986
```{r}
ggplot(data = walking_1986, aes(x = DURATION, y = f, color = MODE)) + 
geom_line() +
  facet_wrap(facets = vars(dest_label)) +
  scale_x_continuous("Time in minutes") +
  scale_y_continuous("Cumulative Percentage of Trips") +
  labs(title = "Impedance function to different destinations in 1986")
#ggsave("IP_1986.png", dpi = 600)
```



4.1 Walking and cycling duration 

Table 1. shows home is the most destination for walking trips.

```{r}
Table_1 <- trip_f %>% filter(MODE == "walking") %>% 
  group_by(dest_label, YEAR) %>%
 summarise(across(.cols = c(DURATION),  # columns
                   .fns =  list("mean" = mean, "Maximum" = max, "Median" = median),                               # 
                   na.rm=T))  
  walking_2015 %>%  count(dest_label) %>%
  mutate(percent = scales::percent(n / sum(n)))
  
   walking_2005 %>%  count(dest_label) %>%
  mutate(percent = scales::percent(n / sum(n)))
   
    walking_1998 %>%  count(dest_label) %>%
  mutate(percent = scales::percent(n / sum(n)))
     
    walking_1992 %>%  count(dest_label) %>%
  mutate(percent = scales::percent(n / sum(n)))
  

```




```{r}
Table_1 <- trip_f %>% filter(MODE == "walking") %>% 
  group_by(dest_label, YEAR) %>%
 summarise(across(.cols = c(DURATION),  # columns
                   .fns =  list("mean" = mean, "Maximum" = max, "Median" = median),                               # 
                   na.rm=T))  
 walking_2015 %>%  count(dest_label) %>%
  mutate(percent = scales::percent(n / sum(n)))
  kable(Table_1) %>%
  kable_styling(latex_options = c("scale_down")) 
kbl(caption = "Summary statistics on walking trips in 2015") %>% kable_classic(full_width = F, html_font = "Cambria") %>%  add_header_above(c(" " = 1, "Duration" = 3))
  
```





